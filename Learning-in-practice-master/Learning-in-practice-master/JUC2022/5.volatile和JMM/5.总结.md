### volatile可见性

| volatile关键字保证<font color = 'red'>可见性:</font> | 对一个被volatile关键字修改的变量                             |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| 1                                                    | <font color = 'red'>写操作的话</font>，这个变量的最新值会立即刷新回到主内存中 |
| 2                                                    | <font color = 'red'>读操作的话</font>，总是能够读取到这个变量的最新值，也就是这个变量最后被修改的值 |
| 3                                                    | 当某个线程收到通知，去读取volatile修饰的变量的值的时候，<font color = 'red'>线程私有工作内存的数据失效</font>，需要重新回到主内存中去读取最新的数据。 |

### 不保证原子性

### volatile禁止指令重排

### 内存屏障是什么

内存屏障︰是一种屏障指令，它使得CPU 或编译器对屏障指令的前和后所发出的内存操作执行一个排序的约束。也叫内存栅栏或栅栏指令

### 内存屏障能干嘛

阻止屏障两边的指令重排序

写数据时加入屏障，强制将线程私有工作内存的数据刷回主物理内存

读数据时加入屏障，线程私有工作内存的数据失效，重新到主物理内存中获取最新数据

### 内存屏障四大指令

在每一个volatile写操作前面插入一个StoreStore屏障

在每一个volatile写操作后面插入一个StoreLoad屏障

在每一个volatile读操作后面插入一个LoadLoad屏障

在每一个volatile读操作后面插入一个LoadStore屏障

# 三句话总结

volatile 写之前的操作，都禁止重排序到volatile之后

volatile 读之后的操作，都禁止重排序到volatile 之前

volatile 写之后volatile读，禁止重排序





