油猴脚本编写教程

# 使用

## **安装插件**

油猴脚本是一个运行浏览器插件线程中的扩展程序

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/1662869594452-b3e0b414-1c1f-40c5-81e4-d88c7e0019a9.png)

## **新建一个脚本**

<img src="%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/1651891475940-ac2f6698-d62f-4c4c-b724-e7f0a9fde3f8-170239038788711.png" alt="image.png" style="zoom:67%;" />

![image-20231212221604502](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231212221604502.png)

## **脚本示例**

### csdn免费复制

```js
// ==UserScript==
// @name         csdn免费复制
// @version      0.1
// @description  直接复制需要登录后才能复制的代码片段
// @author       vanndxh
// @match        https://blog.csdn.net/*/article/details/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tampermonkey.net
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    document.querySelectorAll('code').forEach(i => {
        i.contentEditable = true
    })
})();
```

用jquery抓取并遍历所有code代码，并将可编辑属性contentEditable置为true

### 百度文库破解

这部分分成两部分，复制和全文阅读的破解，可以放在一个脚本里面

复制破解

```js
document.body.addEventListener("keydown", function (e) {
    // Ctrl功能键 + 67（C）或者 mac版的command
    if (e.ctrlKey && e.keyCode == "67" || e.metaKey && e.keyCode == "67") {
        // 目标文本
        let tagetStr = document.querySelector(".search-result-wrap .link").innerText.split("查看全部包含“")[1].split("”的文档")[0];
        // 创建input元素，为实现复制准备
        let input = document.createElement("input");
        // 给input的value属性设置值为目标文本
        input.setAttribute("value", tagetStr);
        // 将input添加到页面
        document.body.appendChild(input);
        // 选中input
        input.select();
        // 执行copy命令
        document.execCommand("copy");
        // 完了之后移除input元素，为下一次初始化
        document.body.removeChild(input);
        // 定时器延迟1毫秒隐藏vip提示和遮罩层
        setTimeout(function () {
            document.querySelector(".dialog-mask").style.display = "none";
            document.querySelector(".copy-limit-dialog-v2").style.display = "none";
        }, 1)
    }
})

// 鼠标抬起触发
document.body.addEventListener("mouseup", function () {
    // 设置不想看见的盒子隐藏
    document.querySelector("#reader-helper").style.display = "none";
})
```

全文阅读破解

```js
// ==UserScript==
// @name         百度文库破解
// @version      0.1
// @description  百度文库复制、全文阅读破解
// @author       vanndxh
// @match        https://wenku.baidu.com/view/*.html
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// @run-at       document-start
// ==/UserScript==

/** 全文阅读部分 */
let data;
Object.defineProperty(window, 'pageData', {
    set: v => data = v,
    get() { 'vipInfo' in data ? data.vipInfo.isVip = 1 : ''; return data; }
})
```

需要注意一下，上方高亮部分代码必须写入！

### 腾讯视频去广告

```js
setInterval(() => {
    let adVideos =
        document.querySelector(".txp_ad")?.children[0].children[0].childNodes;
    adVideos.forEach((i) => {
        if (i.duration !== i.currentTime) {
            i.setAttribute("src", "");
        }
    });
}, 10);
```

### 全网vip破解

```js
// ==UserScript==
// @name              破解VIP会员视频集合
// @namespace         https://greasyfork.org/zh-CN/users/104201
// @version           5.46
// @description       解锁B站大会员，番剧；爱奇艺、腾讯、优酷、芒果等全网VIP视频免费破解去广告(免跳出观影特方便，支持【PC端+移动端，支持自定义接口】)网易云音乐、QQ音乐、酷狗、蜻蜓FM、荔枝FM、喜马拉雅等音乐和有声书音频免客户端下载；B站、A站视频解析下载；油管、Facebook等国外视频解析下载；高清电视频道观看(CCTV、湖南卫视等100多个台)；优惠券查询等【脚本长期维护更新，完全免费，无广告】
// @author            max
// @icon              data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACS0lEQVRYR8WXz2oTURTGv3MnpqhNKy1UWmxRTGdaiLSQRKkKIoK4FVrRPoHu7BMYn0B3+gQquuiuiC6kaFVsAhGEZkKqG/+Vrtp0YWsyR27KlEwz0xnnT3LgwjB37vl+97tzz9whdDiow/pwBCjofN0AJohwKQgkMxYF8Dmt0bxdnhaAQoWTXMczENJBhFvGMgqk4GY6SZXmPgvAmy/cnYijGqrwvmTVHSQup2jLvG0ByJf5EYDbUQIAeJxR6U4LQHGV1VodesTijfQxBdrkaSrL6z0Hlst8i4An7QBgYDar0lMrgM45ItxrCwDjflajnC+AtR8Gvn8zGpz9xwVOjor/Zma/ANt/GIsLNWxt8p7o4IiAmlLQP+C9pvkG+FoyUPxYs52xhFDPKIh3uRviG2ClWIdsTpHoJYymFNdliQzABBsaEZg4p+DwUftliRxAggwOC0xdidma1RaAI92Ea9OHOgcwPqlANruI1AElhsa2dBKXQJEBnDglGlvxWN/BNcE3gKyCS69b64AUlMISwEv4BpDJ3778i/Xfu5XQtFtaLq+9RiCA6gZj/dcuQN8Audod6kvodYZuz9k7UOK7JPDAbXAY/WxgLjtGDy2f408VPi8MLIUh4JbDELhwNknvLQDyQNoTh87AkFuCIP0E/NzcgWYeTC0bdrkNp6Lm9bc4YM4qr/NzEGaCzNJxLONFRqMbzf22JSu/wlcphhwzpsIAIcIHriGXGadX+/MdWDPflTjRxcH+kLYJhYtj5Piz4/0gF4YVNjk6DvAPDb0aMEr8/nEAAAAASUVORK5CYII=
// @include           *://*.youku.com/v_*
// @include           *://*.iqiyi.com/v_*
// @include           *://*.iqiyi.com/w_*
// @include           *://*.iqiyi.com/a_*
// @include           *://*.le.com/ptv/vplay/*
// @include           *://v.qq.com/x/cover/*
// @include           *://v.qq.com/x/page/*
// @include           *://v.qq.com/tv/*
// @include           *://*.tudou.com/listplay/*
// @include           *://*.tudou.com/albumplay/*
// @include           *://*.tudou.com/programs/view/*
// @include           *://*.mgtv.com/b/*
// @include           *://film.sohu.com/album/*
// @include           *://tv.sohu.com/v/*
// @include           *://*.bilibili.com/video/*
// @include           *://*.bilibili.com/bangumi/play/*
// @include           *://*.baofeng.com/play/*
// @include           *://vip.pptv.com/show/*
// @include           *://v.pptv.com/show/*
// @include           *://www.le.com/ptv/vplay/*
// @include           *://www.wasu.cn/Play/show/*
//---------------------------------------------------
// @include           *://m.v.qq.com/x/cover/*
// @include           *://m.v.qq.com/x/page/*
// @include           *://m.v.qq.com/*
// @include           *://m.iqiyi.com/*
// @include           *://m.iqiyi.com/kszt/*
// @include           *://m.youku.com/alipay_video/*
// @include           *://m.mgtv.com/b/*
// @include           *://m.tv.sohu.com/v/*
// @include           *://m.film.sohu.com/album/*
// @include           *://m.le.com/ptv/vplay/*
// @include           *://m.pptv.com/show/*
// @include           *://m.acfun.cn/v/*
// @include           *://m.bilibili.com/video/*
// @include           *://m.bilibili.com/anime/*
// @include           *://m.bilibili.com/bangumi/play/*
// @include           *://m.wasu.cn/Play/show/*
//---------------------------------------------------
// @include           *://www.youtube.com
// @include           *://www.youtube.com/
// @include           *://www.youtube.com/watch*
// @include           *://www.facebook.com/*
// @include           *://yt1s.com/facebook-downloader
//---------------------------------------------------
// @include      	  *music.163.com*
// @include           *://y.qq.com*
// @include           *://www.kugou.com*
// @include           *://www.kuwo.cn*
// @include           *://www.lizhi.fm*
// @include           *://*.ximalaya.com*
// @include           *://music.migu.cn*
//---------------------------------------------------
// @include           *://www.laisoyixia.com/download/detail**
// @include           *://*.ucloud.cn/*
// @include           *://virmach.com/*
// @include           *://www.hostwinds.com/*
// @require           https://cdn.jsdelivr.net/npm/jquery-tampers@3.2.1/jquery.min.js
// @connect			  tt.shuqiandiqiu.com
// @connect           api.bilibili.com
// @grant             unsafeWindow
// @grant             GM_openInTab
// @grant             GM.openInTab
// @grant             GM_getValue
// @grant             GM.getValue
// @grant             GM_setValue
// @grant             GM.setValue
// @grant             GM_xmlhttpRequest
// @grant             GM.xmlHttpRequest
// @grant             GM_registerMenuCommand
// @license           MIT
// @charset		      UTF-8
// ==/UserScript==

(function () {
	'use strict';
	var $ = $ || window.$;

	//如果本地值不能满足需求，可自定义添加接口到此处
	//注意数据格式
	//category=1:全网VIP解析内嵌页播放
	//category=2:全网VIP解析新建页面播放
	var customizeInterfaceList=[
		//{ name:"就是名字而已", category:"1", url:"https://jx.idc126.net/jx/?url="},
		//{ name:"就是名字而已", category:"2", url:"https://jx.idc126.net/jx/?url="},
	];

	//视频vip解析收集自脚本：
	//https://greasyfork.org/zh-CN/scripts/390952
	//https://greasyfork.org/zh-CN/scripts/398195

	//默认值，当网络请求出现错误时使用此值
	var originalInterfaceList = [
		{"name":"纯净解析","category":"1","url":"https://z1.m1907.cn/?jx="},
		{"name":"高速接口1","category":"1","url":"https://jsap.attakids.com/?url="},
		{"name":"B站解析1","category":"1","url":"https://vip.parwix.com:4433/player/?url="},
		{"name":"B站解析2","category":"1","url":"https://www.cuan.la/m3u8.php?url="},
		{"name":"乐多资源","category":"1","url":"https://api.leduotv.com/wp-api/ifr.php?isDp=1&vid="},
		{"name":"ccyjjd","category":"1","url":"https://ckmov.ccyjjd.com/ckmov/?url="},
		{"name":"七哥","category":"1","url":"https://jx.mmkv.cn/tv.php?url="},
		{"name":"M3U8","category":"1","url":"https://jx.m3u8.tv/jiexi/?url="},
		{"name":"大白","category":"1","url":"https://api.myzch.cn/?url="},
		{"name":"老板","category":"1","url":"https://vip.laobandq.com/jiexi.php?url="},
		{"name":"云点播","category":"1","url":"https://api.iopenyun.com:88/vip/?url="},
		{"name":"爱豆","category":"1","url":"https://jx.aidouer.net/?url="},
		{"name":"Ckplayer","category":"1","url":"https://www.ckplayer.vip/jiexi/?url="},
		{"name":"BL","category":"1","url":"https://vip.bljiex.com/?v="},
		{"name":"Mao解析","category":"1","url":"https://91jxs.com/jiexi/?url="},
		{"name":"盘古","category":"1","url":"https://www.pangujiexi.cc/jiexi.php?url="},
		{"name":"ckmov","category":"1","url":"https://www.ckmov.vip/api.php?url="},
		{"name":"迪奥","category":"1","url":"https://123.1dior.cn/?url="},
		{"name":"RDHK","category":"1","url":"https://jx.rdhk.net/?v="},
		{"name":"H8","category":"1","url":"https://www.h8jx.com/jiexi.php?url="},
		{"name":"解析la","category":"1","url":"https://api.jiexi.la/?url="},
		{"name":"久播","category":"1","url":"https://jx.jiubojx.com/vip.php?url="},
		{"name":"九八","category":"1","url":"https://jx.youyitv.com/?url="},
		{"name":"MUTV","category":"1","url":"https://jiexi.janan.net/jiexi/?url="},
		{"name":"明日","category":"1","url":"https://jx.yingxiangbao.cn/vip.php?url="},
		{"name":"磨菇","category":"1","url":"https://jx.wzslw.cn/?url="},
		{"name":"OK","category":"1","url":"https://okjx.cc/?url="},
		{"name":"维多","category":"1","url":"https://jx.ivito.cn/?url="},
		{"name":"小蒋","category":"1","url":"https://www.kpezp.cn/jlexi.php?url="},
		{"name":"星驰","category":"1","url":"https://vip.cjys.top/?url="},
		{"name":"星空","category":"1","url":"http://60jx.com/?url="},
		{"name":"月亮","category":"1","url":"https://api.yueliangjx.com/?url="},
		{"name":"0523","category":"1","url":"https://go.yh0523.cn/y.cy?url="},
		{"name":"云端","category":"1","url":"https://jx.ergan.top/?url="},
		{"name":"17云","category":"1","url":"https://www.1717yun.com/jx/ty.php?url="},
		{"name":"66","category":"1","url":"https://api.3jx.top/vip/?url="},
		{"name":"116","category":"1","url":"https://jx.116kan.com/?url="},
		{"name":"200","category":"1","url":"https://vip.66parse.club/?url="},
		{"name":"云析","category":"1","url":"https://jx.yparse.com/index.php?url="},
		{"name":"8090","category":"1","url":"https://www.8090g.cn/?url="},

		{"name":"综合线路解析","category":"2","url":"https://www.showxi.xyz/mov/s/?sv=3&url="},
		{"name":"纯净解析","category":"2","url":"https://z1.m1907.cn/?jx="},
		{"name":"高速接口1","category":"2","url":"https://jsap.attakids.com/?url="},
		{"name":"高速接口2","category":"2","url":"https://api.sigujx.com/?url="},
		{"name":"B站解析1","category":"2","url":"https://vip.parwix.com:4433/player/?url="},
		{"name":"B站解析2","category":"2","url":"https://www.cuan.la/m3u8.php?url="},
		{"name":"Ckplayer","category":"2","url":"https://www.ckplayer.vip/jiexi/?url="},
		{"name":"乐多资源","category":"2","url":"https://api.leduotv.com/wp-api/ifr.php?isDp=1&vid="},
		{"name":"ccyjjd","category":"2","url":"https://ckmov.ccyjjd.com/ckmov/?url="},
		{"name":"M3U8","category":"2","url":"https://jx.m3u8.tv/jiexi/?url="},
		{"name":"BL","category":"2","url":"https://vip.bljiex.com/?v="},
		{"name":"Mao解析","category":"2","url":"https://qd.hxys.tv/m3u8.php?url="}
	];
	var playerNodes = [
		{ url:"v.qq.com", node:"#mod_player"},
		{ url:"www.iqiyi.com", node:"#flashbox"},
		{ url:"v.youku.com", node:"#player"},
		{ url:"w.mgtv.com", node:"#mgtv-player-wrap"},
		{ url:"www.mgtv.com", node:"#mgtv-player-wrap"},
		{ url:"tv.sohu.com", node:"#player"},
		{ url:"film.sohu.com", node:"#playerWrap"},
		{ url:"www.le.com", node:"#le_playbox"},
		{ url:"video.tudou.com", node:".td-playbox"},
		{ url:"v.pptv.com", node:"#pptv_playpage_box"},
		{ url:"vip.pptv.com", node:".w-video"},
		{ url:"www.wasu.cn", node:"#flashContent"},
		{ url:"www.acfun.cn", node:"#player"},
		{ url:"www.bilibili.com", node:"#player_module"},
		{ url:"vip.1905.com", node:"#player"},
	];

	let newOriginalInterfaceList = originalInterfaceList;
	try{
		newOriginalInterfaceList = customizeInterfaceList.concat(originalInterfaceList);
	}catch(e){
		console.log("自定义解析接口错误，注意数据格式....");
	}

	/**
	 * 共有方法
	 */
	function commonFunction(){
		this.GMgetValue = function (name, value) { //得到存在本地的数据
			if (typeof GM_getValue === "function") {
				return GM_getValue(name, value);
			} else {
				return GM.getValue(name, value);
			}
		};
		this.GMsetValue = function(name, value){
			if (typeof GM_setValue === "function") {
				return GM_setValue(name, value);
			} else {
				return GM.setValue(name, value);
			}
		};
		this.GMaddStyle = function(css){
			var myStyle = document.createElement('style');
			myStyle.textContent = css;
			var doc = document.head || document.documentElement;
			doc.appendChild(myStyle);
		};
		this.GMopenInTab = function(url, open_in_background){
			if (typeof GM_openInTab === "function") {
				GM_openInTab(url, open_in_background);
			} else {
				GM.openInTab(url, open_in_background);
			}
		};
		this.addScript = function(url){
			var s = document.createElement('script');
			s.setAttribute('src',url);
			document.body.appendChild(s);
		};
		this.randomNumber = function(){
			return Math.ceil(Math.random()*100000000);
		};
		this.request = function(mothed, url, param){
			return new Promise(function(resolve, reject){
				GM_xmlhttpRequest({
					url: url,
					method: mothed,
					data:param,
					onload: function(response) {
						var status = response.status;
						var playurl = "";
						if(status==200||status=='200'){
							var responseText = response.responseText;
							resolve({"result":"success", "data":responseText});
						}else{
							reject({"result":"error", "data":null});
						}
					}
				});
			})
		};
	}
	//全局统一变量
	const commonFunctionObject = new commonFunction();

	/**
	 * 超级解析助手
	 * @param {Object} originalInterfaceList
	 * @param {Object} playerNodes
	 */
	function superVideoHelper(originalInterfaceList, playerNodes){
		this.originalInterfaceList = originalInterfaceList;
		this.node = "";
		this.elementId = Math.ceil(Math.random()*100000000);
		for(var i in playerNodes) { //获得窗口ID
			if (playerNodes[i].url == window.location.host) {
				this.node = playerNodes[i].node;
				break;
			}
		}
		this.isRun = function(){ //判断是否运行
			var urls = ["iqiyi.com","v.qq.com","youku.com", "le.com","tudou.com","mgtv.com","sohu.com", "acfun.cn","bilibili.com","baofeng.com","pptv.com"];
			for(var i=0; i<urls.length;i++){
				if((window.location.host!=="bilibili.com" && window.location.host.indexOf(urls[i])!=-1)
					|| (window.location.host==="bilibili.com" && window.location.href.indexOf("bangumi/play")!=-1)){
					return true;
				}
			}
			return false;
		};
		this.innerParse = function(url) { //内嵌解析
			$("#iframe-player").attr("src", url);
		};
		this.addHtmlElements = function(){
			var vipVideoImageBase64 =`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC9klEQVRoQ+2ZPWgVQRDH/7/CWqOIYOFHFbRSjJhGMGDpByoIago70cqvUtQgdipWFqawMWghGIidhcHKQAJqEURBRfED1CCCjc3IPu4em31775J7d3m8cAtX3O7szP7nPzszx6EeH/T4+VUD6DaDTQbMbE+3D7MY+8Ckkw8BPFuMki7KDtUAuuh9Z3oZMtBljxY2X9eBwq4raWPNQEmOLKxm+TBgZqsknQ1dAVzNco+ZhWsm6ZakHZLC1mQyrZ5OX2RvzMxnSa8lzQJ/YwLzGDCze5JOeoI/gbVtAMxJ6vPW7wKnkr4qbEuaxccDcGWBsfNV0mjMmSGAg5LGA6XbgFehITPbLel5MN84ZAUAUjMPgWO+zZY7YGbvJW0OvRoB8EjSEW9+BhhIvOvCp0wGfPPbgZfpRAzATUnn56GEmJyLd39cBNxeF99FADTa42BskuQef4wDh9oB2CXpRbDpMPA4nTOz05LuBDLrgW+dAACGIkxfkHTDm/8DrMwEkBxgOskkqdwEcMAD4GLf3YF0PACOe+uFGMgA4Bj4EAAbAGbcXLQOmNklSdeCTRuBT2bWL+lNsLYfeFIRgH2SJgJ7GwCXYjMBrJb0K9jUiHEzG5F02VubA9b4skXvQMiAmW2VdFSSn24/As0kk1mJzeyppL3ewaaBnWY2K2mLNz8S5ueCAMLwz3q/DZxreweSe3BC0v1Ai7tkYXrsB96WwMBCAfQBv3MBJCD+SVrhaXaZ54z3PgUMhpYrZKCF7bbNnJk5BhwT6fghyW8thoGxigE4my6tXwemQlt5AGI1oamDSIFLmCuURiW5BOGPL8C7drGV206b2XdJ6yJKxoDhmPKCIeS61ZZClncxFgLAtcyxrnEwRmknDFQFIFYTWnJ/CVmoGgYSj7Z81OR86Lg7sOgPmnY6s0IpN4TyYrDb6zWAmoEOPVCHUIcO7Hh7/YemYxcWU7AMf3BkNGDF/FP9rkwGqjddkoWWv5Ql6V1yNXUdWHKXBwZ7noH/dP+HQNqheToAAAAASUVORK5CYII=`;
			var tvImageBase64=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACvUlEQVRoQ+2ZPYwNURTHf/9Gp/ARCpFYoVDZRCMqGgrRKCgoyCZE46MgaNiCRLIhu4WPDaIgkWwhEZHQ0IqPIFGI+AgJsQ0FKnHkbs5s5o2Z9+atmX33JXOb9+Z+nPv/n/+9Z+65I/q8qM/x0xDotYKNAlEpYGa7gC3A/F4DK5j/C3Bb0s2kfXoJmdky4H2kwLOwBiR9CJVpAieBE31CYFhSwNuWwMPIyKxP4SlFYIOkKEiYWQD/oCHQqyXVKJD2vJldB5aUUCOEubuSJswsRIzPksbzxpnZOmAjcEHS12yfyhRwIN2E2mHgI3DFQW2SdD/jkEXAM3fKdHTJ9KluE5vZCLAm46UkxKWjVlAgEFgIPPb+NyTtzIA7Bpz2uiFJV2tToED+EN6mCEjKPRyaWXj1b/fxqyW9DP/NbC7wHFgOTEpaXDBHdQrkeKcMgc3AHR87KumgEwi/57z+qKQzURJwsAnRb8AA8BMISqwCvgMLJP2JmcAQcNkBHgF+AOf9eUTS4aLIVlkUmukecAXm+HoPHn/jCgwCv4IikiajJuAkjgOnMkDHJB1o916JQgEnsBR4AcxzwL+BQUmv+oKAkxgF9jvgi5L2tQPvY2oNo0kidE3S7hJgVgBjvolD6HxXYkx9BBIP1Zk71LoHOnmvivaGQBVe/B8bM1UgnCRjKuljfKmkPibwWSy5BEJGdC9m1ClsayU9Cs8t53dPF3dETuKWpK0Jxn8SEDML+e7KCki03OMAVdwxfZL0No2tluv1dlGjAse0mGgI5Hk0OgX86j0cqMIVfC7mnMqp22Mv3b5TngBPJYXvAW1LqSVkZpeAPZ2MVdw+IWlbJ5tlCVgnQ3W0F13TdB2FzOwscKgOkG1sjkva22nOUgoEI74PivZAp3m6bX9dZv0Ho6UJdItgtvo3BGbL00XzNAr0WoG/02m4QKQE53EAAAAASUVORK5CYII=`;
			var category_1_html = "";
			var category_2_html = "";
			this.originalInterfaceList.forEach((item, index) => {
				if (item.category === "1") {
					category_1_html += "<li title='"+item.name+"' data-index='"+index+"'>" + item.name + "</li>";
				}
				if (item.category === "2") {
					category_2_html += "<li title='"+item.name+"' data-index='"+index+"'>" + item.name + "</li>";
				}
			});

			//获得自定义位置
			var left = 0;
			var top = 130;
			var Position = commonFunctionObject.GMgetValue("Position_" + window.location.host);
			if(!!Position){
				left = Position.left;
				top = Position.top;
			}
			var cssMould = `#vip_movie_box`+this.elementId+` {cursor:pointer; position:fixed; top:` + top + `px; left:` + left + `px; width:0px; z-index:2147483647; font-size:16px; text-align:left;}
							#vip_movie_box`+this.elementId+` .item_text {}
							#vip_movie_box`+this.elementId+` .item_text .img_box{width:26px; height:35px;line-height:35px;text-align:center;background-color:#E5212E;}
							#vip_movie_box`+this.elementId+` .item_text .img_box >img {width:20px; display:inline-block; vertical-align:middle;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_action {display:none; position:absolute; left:26px; top:0; text-align:center; background-color:#272930; border:1px solid gray;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_action li{border-radius:2px; font-size:12px; color:#DCDCDC; text-align:center; width:60px; line-height:21px; float:left; border:1px solid gray; padding:0 4px; margin:4px 2px;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;-o-text-overflow:ellipsis;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_action li:hover{color:#E5212E; border:1px solid #E5212E;}

							#vip_movie_box`+this.elementId+` li.selected{color:#E5212E; border:1px solid #E5212E;}


							#vip_movie_box`+this.elementId+` .selected_text {margin-top:5px;}
							#vip_movie_box`+this.elementId+` .selected_text .img_box{width:26px; height:35px;line-height:35px;text-align:center;background-color:#E5212E;}
							#vip_movie_box`+this.elementId+` .selected_text .img_box >img {width:20px; height:20px;display:inline-block; vertical-align:middle;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_selected {display:none;position:absolute; left:26px; top:0; text-align:center; background-color:#F5F6CE; border:1px solid gray;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_selected ul{overflow-y: auto;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_selected li{border-radius:2px; font-size:12px; color:#393AE6; text-align:center; width:95px; line-height:27px; float:left; border:1px dashed gray; padding:0 4px; margin:4px 2px;display:block;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;}
							#vip_movie_box`+this.elementId+` .vip_mod_box_selected li:hover{color:#E5212E; border:1px solid #E5212E;}

							#vip_movie_box`+this.elementId+` .default-scrollbar-55678::-webkit-scrollbar{width:5px; height:1px;}
							#vip_movie_box`+this.elementId+` .default-scrollbar-55678::-webkit-scrollbar-thumb{box-shadow:inset 0 0 5px rgba(0, 0, 0, 0.2); background:#A8A8A8;}
							#vip_movie_box`+this.elementId+` .default-scrollbar-55678::-webkit-scrollbar-track{box-shadow:inset 0 0 5px rgba(0, 0, 0, 0.2); background:#F1F1F1;}
							`
			commonFunctionObject.GMaddStyle(cssMould);

			var htmlMould = `<div id='vip_movie_box`+this.elementId+`'>
								<div class='item_text'>
									<div class="img_box" id="img_box_6667897iio"><img src='`+ vipVideoImageBase64 +`' title='点击跳转到综合解析页面，线路随意选！'/></div>
										<div class='vip_mod_box_action' >
											<div style='display:flex;'>
												<div style='padding:10px 0px; width:380px; max-height:400px; overflow-y:auto;'  class="default-scrollbar-55678">
													<div>
														<div style='font-size:16px; text-align:center; color:#E5212E; padding:5px 0px;'><b>全网VIP视频解析[内嵌播放]</b></div>
														<ul>
															` + category_1_html + `
															<div style='clear:both;'></div>
														</ul>
													</div>
													<div>
														<div style='font-size:16px; text-align:center; color:#E5212E; padding:5px 0px;'><b>全网VIP视频解析[弹窗播放]</b></div>
														<ul>
														` + category_2_html + `
														<div style='clear:both;'></div>
														</ul>
													</div>
												</div>
											<div>
										</div>
									</div>
								</div>
							</div>
							`;
			$("body").append(htmlMould);
		};
		this.mouseEvent = function(){
			$(".item_text").on("mouseover", () => {
				$(".vip_mod_box_action").show();
			});
			$(".item_text").on("mouseout", () => {
				$(".vip_mod_box_action").hide();
			});
			$(".vip_mod_box_action li").each((liIndex, item) => {
				item.addEventListener("click", () => {
					var videoPlayer = $("<div id='iframe-play-div' style='width:100%;height:100%;z-index:1000;'><iframe id='iframe-player' frameborder='0' allowfullscreen='true' width='100%' height='100%'></iframe></div>");
					var index = parseInt($(item).attr("data-index"));
					var category = this.originalInterfaceList[index].category;
					var url = this.originalInterfaceList[index].url + window.location.href;
					if (category==="1") { //内嵌播放....
						if (document.getElementById("iframe-player") == null) {
							var player = $(this.node);
							player.empty();
							player.append(videoPlayer);
						}
						this.innerParse(url);  //把播放链接加入到自定义的div
					}
					if (category==="2"){  //弹窗播放....
						commonFunctionObject.GMopenInTab(url, false);
					}
					//把点击过的标红
					$(".vip_mod_box_action li").removeClass("selected");
					$(item).addClass("selected");
				});
			});
			//右键移动位置
			var movie_box = $("#vip_movie_box"+this.elementId);
			movie_box.mousedown(function(e) {
				if (e.which == 3) {
					e.preventDefault()
					movie_box.css("cursor", "move");
					var positionDiv = $(this).offset();
					var distenceX = e.pageX - positionDiv.left;
					var distenceY = e.pageY - positionDiv.top;

					$(document).mousemove(function(e) {
						var x = e.pageX - distenceX;
						var y = e.pageY - distenceY;
						var windowWidth = $(window).width();
						var windowHeight = $(window).height();

						if (x < 0) {
							x = 0;
						} else if (x >  windowWidth- movie_box.outerWidth(true) - 100) {
							x = windowWidth - movie_box.outerWidth(true) - 100;
						}

						if (y < 0) {
							y = 0;
						} else if (y > windowHeight - movie_box.outerHeight(true)) {
							y = windowHeight - movie_box.outerHeight(true);
						}

						movie_box.css("left", x);
						movie_box.css("top", y);
						commonFunctionObject.GMsetValue("Position_" + window.location.host,{ "left":x, "top":y});
					});
					$(document).mouseup(function() {
						$(document).off('mousemove');
						movie_box.css("cursor", "pointer");
					});
					$(document).contextmenu(function(e) {
						e.preventDefault();
					})
				}
			});
			//点击视频播放界面
			$("#img_box_6667897iio").on("click", function(){
				commonFunctionObject.GMopenInTab("https://www.xixicai.top/mov/s/?sv=3&url="+window.location.href, false);
			});
		};

		//视频广告过滤相关代码借鉴自其它脚本，该部分代码版权归原作者所有！在此感谢
		//借鉴脚本作者：sign
		//地址：https://greasyfork.org/zh-CN/scripts/406849
		//修改：优化了该段代码的逻辑，使可读性更高
		this.videAdemove = function(){
			switch (window.location.host) {
				case 'www.iqiyi.com':
					try{
						unsafeWindow.rate = 0;
						unsafeWindow.Date.now = () => {
							return new unsafeWindow.Date().getTime() + (unsafeWindow.rate += 1000);
						}
						setInterval(() => {
							unsafeWindow.rate = 0;
						}, 600000);
					}catch(e){}

					//广告过滤iqiyi有点问题，10s后循环结束
					let iqiyiDelay = 0;
					let iqiyiInterval =  setInterval(() => {
						try{
							let cupidPublicTime = document.getElementsByClassName("cupid-public-time");
							if(cupidPublicTime.length!=0 && !!cupidPublicTime[0]){
								$(".skippable-after").css("display", "block");
								let skippableAfter = document.getElementsByClassName("skippable-after");
								if(skippableAfter.length!=0 && !!skippableAfter[0]){
									skippableAfter[0].click();
								}
							}
							$(".qy-player-vippay-popup").css("display", "none");
							$(".black-screen").css("display", "none");
						}catch(e){}
						if(iqiyiDelay>=10000){
							clearInterval(iqiyiInterval);
						}
						iqiyiDelay += 500;
					}, 500);
					break;
				case 'v.qq.com':
					setInterval(() => { //视频广告加速
						try{
							$(".txp_ad").find("txpdiv").find("video")[0].currentTime = 1000;
							$(".txp_ad").find("txpdiv").find("video")[1].currentTime = 1000;
						}catch(e){}
					}, 1000)
					setInterval(() => {
						try{
							var txp_btn_volume = $(".txp_btn_volume");
							if (txp_btn_volume.attr("data-status") === "mute") {
								$(".txp_popup_volume").css("display", "block");
								txp_btn_volume.click();
								$(".txp_popup_volume").css("display", "none");
							}
							//$("txpdiv[data-role='hd-ad-adapter-adlayer']").attr("class", "txp_none");
							$(".mod_vip_popup").css("display", "none");
							$(".tvip_layer").css("display", "none");
							$("#mask_layer").css("display", "none");
						}catch(e){}
					}, 500);

					break
				case 'v.youku.com':
					try{
						window.onload = function () {
							if (!document.querySelectorAll('video')[0]) {
								setInterval(() => {
									document.querySelectorAll('video')[1].playbackRate = 16;
								}, 100)
							}
						}
					}catch(e){}
					setInterval(() => {
						try{
							var H5 = $(".h5-ext-layer").find("div")
							if(H5.length != 0){
								$(".h5-ext-layer div").remove();
								var control_btn_play = $(".control-left-grid .control-play-icon");
								if (control_btn_play.attr("data-tip") === "播放") {
									$(".h5player-dashboard").css("display", "block");
									control_btn_play.click();
									$(".h5player-dashboard").css("display", "none");
								}
							}
							$(".information-tips").css("display", "none");
						}catch(e){}
					}, 500);

					break
				case 'www.mgtv.com':

					break
				case 'tv.sohu.com':
					setInterval(() => {
						try{
							$(".x-video-adv").css("display", "none");
							$(".x-player-mask").css("display", "none");
							$("#player_vipTips").css("display", "none");
						}catch(e){}
					}, 500);

					break
				case 'www.bilibili.com':

					break
			}
		};
		this.start = function(){
			if(this.isRun()){
				let delayTimeMs = 0;
				if(window.location.host.indexOf("www.bilibili.com")!=-1){//如果是哔哩哔哩，则需要延迟加载
					delayTimeMs = 2000;
				}
				setTimeout(()=>{
					this.addHtmlElements();
					this.mouseEvent();
					this.videAdemove();
				}, delayTimeMs);
			}
		};
	};

	//B站相关功能
	function huahuacat_bilibili(toolObject){
		this.toolObject=toolObject;
		this.downloadResutError=function($btn){
			$btn.text("下载视频（最高请）");
			$btn.removeAttr("disabled");
		};
		this.downloadResutSuccess=function($btn){
			$btn.text("下载视频（最高请）");
			$btn.removeAttr("disabled");
		};
		this.downloadVideo=function($btn){
			var pathname = window.location.pathname;
			var bv = pathname.replace("/video/","").replace("/","");
			if(!bv){
				this.downloadResutError();
			}else{
				//bv转av
				toolObject.request("get", "http://api.bilibili.com/x/web-interface/archive/stat?bvid="+bv, null).then((resultData)=>{
					let dataJson = JSON.parse(resultData.data);
					if(!!dataJson && dataJson.code===0 && !!dataJson.data){
						let aid = dataJson.data.aid;
						if(!aid){
							this.downloadResutError($btn);
						}else{
							//获取cid
							toolObject.request("get", "https://api.bilibili.com/x/web-interface/view?aid="+aid, null).then((resultData2)=>{
								let dataJson2 = JSON.parse(resultData2.data);
								if(!!dataJson2 && dataJson2.code===0 && !!dataJson2.data){
									let aid = dataJson2.data.aid;
									let bvid = dataJson2.data.bvid;
									let cid = dataJson2.data.cid;
									if(!aid || !bvid || !cid){
										this.downloadResutError($btn);
									}else{
										//获取播放链接
										toolObject.request("get", "https://api.bilibili.com/x/player/playurl?avid="+aid+"&cid="+cid+"&qn=112", null).then((resultData3)=>{
											let dataJson3 = JSON.parse(resultData3.data);
											if(!!dataJson3 && dataJson3.code===0 && !!dataJson3.data){
												this.downloadResutSuccess($btn);
												window.open(dataJson3.data.durl[0].url);
											}
										}).catch((errorData)=>{
											this.downloadResutError($btn);
										});
									}
								}
							}).catch((errorData)=>{
								this.downloadResutError($btn);
							});
						}
					}
				}).catch((errorData)=>{
					this.downloadResutError();
				});
			}
		}
		this.createElementHtml = function(){
			let randomNumber = this.toolObject.randomNumber();
			let cssText =
			`
				#bilibili_exti_`+randomNumber+`{padding:10px;}
				#bilibili_exti_`+randomNumber+` >.self_s_btn{background-color:#FB7299; color:#FFF; font-size:10px;display:inline-block; margin-right:15px;padding:2px 4px;border-radius:3px;cursor:pointer;}
			`;
			let htmlText=
			`
				<div id="bilibili_exti_`+randomNumber+`">
					<span class="self_s_btn" id="download_s_`+randomNumber+`">下载视频（最高请）</span>
					<span class="self_s_btn" id="focus_s_`+randomNumber+`">一键三联</span>
				</div>
			`;
			setTimeout(()=>{
				if($("#bilibili-player").html().length >= 10){
					$("body").prepend("<style>"+cssText+"</style>");
					$("#viewbox_report div.video-data").append(htmlText);
					let $that = this;
					$("#download_s_"+randomNumber).on("click", function(){
						$(this).attr("disabled", "disabled");
						$(this).text("下载视频（准备中）")
						$that.downloadVideo($(this));
					});
					$("#focus_s_"+randomNumber).on("click", function(){
						$("#arc_toolbar_report .like").click();
						$("#arc_toolbar_report .coin").click();
					});
				}
			}, 2500);
		}
		this.start = function(){
			if(window.location.host==="www.bilibili.com" && window.location.pathname.indexOf("/video")!=-1){
				this.createElementHtml();
			}
		}
	}

	//国外的一些解析
	function abroadVideoHelper(){
		this.isRun = function(){
			var urls=["youtube.com", "facebook.com"];
			for(var i=0; i<urls.length;i++){
				if(window.location.host.indexOf(urls[i])!=-1){
					return true;
				}
			}
			return false;
		};
		this.start = function(){
			if(!this.isRun()){
				return;
			}
			setInterval(function(){
				const host = window.location.host;
				const href = window.location.href;
				const eleId = "free-xx1-player-script-9999";

				//youtube解析
				if(host.indexOf("youtube.com")!=-1){
					if(href.indexOf("youtube.com/watch")!=-1){
						if($("#"+eleId).length != 0){
							return;
						}
						var iconVideo = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADOUlEQVRoQ+2Zz4uNURjHP9+F8g8gykKJNJMUUmzMDKZmYVYsLBRhOaEmFhRRLCZDY4PBrJRREkUMmY3URCk/s6GMhR9ZWNk9OvXO7b133ve+57w/7szUnLqbe59fn/Oc85znnCvm+NAcj595gHgGzWwDsBZYDawEFgI/gT/AR0nDZWe8lAyYWTewF9iTEeA4MCTpblkghQHM7BxwPDCgAUn9gTqJ4oUAzOwKcChnICOS9uXUranlBjCza8CBggFclHSkiI1cAGbWBTwt4jim2y3pSV5bwQBmtgq4BazP67RB7w3gsvAX+CbpV4hdL4CoPG4H3KcjxEEOWVdyHwPjkq5m6WcCmNmFaIaybFXx+2vgsqSRNOOpAGa2GHhY4lIpAnha0qkkA4kAZuZO0k9FPFag2yHJHYR1Iw3gO7CsgiCKmPwMdEmajBuZBmBmbuMcLOKpQt1BSUdTAczMVZmQmjwtpTmC3xqo0ybpw5ROXQbMrA+45GtQUmYVy7JlZpYl0/B73YZuBAjqbWYI4KWkzWkZeBVSNuMAZua1FBorSY4MTEpangYQlM4EgOdZy6ExazkAiNtoXELvgLasIGr0sT0QZaAVAO8ltadlYBTYNcsB7kjanQZwHjg2ywGaViHXIruN7DVmYA+4lnudpC+JGXBfhlwTZwDAPQi4s6o2kloJ9yzyyKcXajGA64F6JL1tChBlwdX0oIrSgirUK+l+49pudh/IhGhhBvolDSRtzKa9jJktBdxrWk+icvXnwO3oIexFWlXJbMbMbAGwJQWg1o0WWEKpLUjSBcZ7CXnV0ZhQXoBQP/MAUzNgZu5Z8EbRGQT2S7qZ107mHmhmuIQnl2lXxFCQQgDRmTEGbAt1DIxJ2pFDr06lDIBFgDsdlwQE8wNol/Q7QCdRtDBAlIVO4FlAMJ2SMk96H3ulAEQQh4FBD6d9koY85LxESgOIIK67qtLE87CkUt+cSgWIICaAjQkQE5I2eU1rgFAVACsA9/Dk/qGcGv+ANZK+BsTmJVo6QJSFXuBeLIKdkh54RRQoVAlABHECOAOclHQ2MC5v8coAIojR+AuCd1QBgpUCBMSRW3QeIPfUlaT4H0/7RUAi2a/NAAAAAElFTkSuQmCC";
						var html='<div id="'+eleId+'" style="width:25px;padding:10px 0px;text-align:center;background-color:#E5212E;position:fixed;top:250px;left:0px;color:#FFF;font-size:0px;z-index:9999999999999;cursor:pointer;margin:0px auto;text-align:center;">'+
							'<img src="'+iconVideo+'" style="width:20px;">'+
							'</div>';
						$("body").append(html);
						$("body").on("click", "#"+eleId, function(){
							var location_url = window.location.href;
							var videourl = "https://yt1s.com/?q="+location_url;
							commonFunctionObject.GMopenInTab(videourl, false);
						});
					}else{
						$("#"+eleId).remove();
					}
				}

				//facebook解析
				if(host.indexOf("facebook.com")!=-1){
					if(href.indexOf("facebook.com/watch")!=-1 || href.indexOf("/videos/")!=-1){
						if($("#"+eleId).length != 0){
							return;
						}
						var iconVideo = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADOUlEQVRoQ+2Zz4uNURjHP9+F8g8gykKJNJMUUmzMDKZmYVYsLBRhOaEmFhRRLCZDY4PBrJRREkUMmY3URCk/s6GMhR9ZWNk9OvXO7b133ve+57w/7szUnLqbe59fn/Oc85znnCvm+NAcj595gHgGzWwDsBZYDawEFgI/gT/AR0nDZWe8lAyYWTewF9iTEeA4MCTpblkghQHM7BxwPDCgAUn9gTqJ4oUAzOwKcChnICOS9uXUranlBjCza8CBggFclHSkiI1cAGbWBTwt4jim2y3pSV5bwQBmtgq4BazP67RB7w3gsvAX+CbpV4hdL4CoPG4H3KcjxEEOWVdyHwPjkq5m6WcCmNmFaIaybFXx+2vgsqSRNOOpAGa2GHhY4lIpAnha0qkkA4kAZuZO0k9FPFag2yHJHYR1Iw3gO7CsgiCKmPwMdEmajBuZBmBmbuMcLOKpQt1BSUdTAczMVZmQmjwtpTmC3xqo0ybpw5ROXQbMrA+45GtQUmYVy7JlZpYl0/B73YZuBAjqbWYI4KWkzWkZeBVSNuMAZua1FBorSY4MTEpangYQlM4EgOdZy6ExazkAiNtoXELvgLasIGr0sT0QZaAVAO8ltadlYBTYNcsB7kjanQZwHjg2ywGaViHXIruN7DVmYA+4lnudpC+JGXBfhlwTZwDAPQi4s6o2kloJ9yzyyKcXajGA64F6JL1tChBlwdX0oIrSgirUK+l+49pudh/IhGhhBvolDSRtzKa9jJktBdxrWk+icvXnwO3oIexFWlXJbMbMbAGwJQWg1o0WWEKpLUjSBcZ7CXnV0ZhQXoBQP/MAUzNgZu5Z8EbRGQT2S7qZ107mHmhmuIQnl2lXxFCQQgDRmTEGbAt1DIxJ2pFDr06lDIBFgDsdlwQE8wNol/Q7QCdRtDBAlIVO4FlAMJ2SMk96H3ulAEQQh4FBD6d9koY85LxESgOIIK67qtLE87CkUt+cSgWIICaAjQkQE5I2eU1rgFAVACsA9/Dk/qGcGv+ANZK+BsTmJVo6QJSFXuBeLIKdkh54RRQoVAlABHECOAOclHQ2MC5v8coAIojR+AuCd1QBgpUCBMSRW3QeIPfUlaT4H0/7RUAi2a/NAAAAAElFTkSuQmCC";
						var html='<div id="'+eleId+'" style="width:25px;padding:10px 0px;text-align:center;background-color:#E5212E;position:fixed;top:250px;left:0px;color:#FFF;font-size:0px;z-index:9999999999999;cursor:pointer;margin:0px auto;text-align:center;">'+
							'<img src="'+iconVideo+'" style="width:20px;">'+
							'</div>';
						$("body").append(html);
						$("body").on("click", "#"+eleId, function(){
							var location_url = window.location.href;
							commonFunctionObject.GMsetValue("facebook_downloader_obj", {"facebook_url":location_url});
							commonFunctionObject.GMopenInTab("https://yt1s.com/facebook-downloader", false);
						});
					}else{
						$("#"+eleId).remove();
					}
				}
			}, 500);

			if(window.location.href.indexOf("yt1s.com/facebook-downloader")!=-1){ //facebook下载
				var facebookObject = commonFunctionObject.GMgetValue("facebook_downloader_obj");
				if(!!facebookObject){
					$("#s_input").val(facebookObject.facebook_url);
				}
			}
		}
	}

	//优惠券查询
	function queryCoupon(){
		this.isRun = function(){
			var urls=["detail.tmall.com", "item.taobao.com", "item.jd.com", "item.yiyaojd.com", "npcitem.jd.hk", "detail.tmall.hk"];
			for(var i=0; i<urls.length;i++){
				if(window.location.host.indexOf(urls[i])!=-1){
					return true;
				}
			}
			return false;
		}
		this.getPlatform = function(){
			let host = window.location.host;
			let platform = "";
			if(host.indexOf("detail.tmall")!=-1){
				platform = "tmall";
			}else if(host.indexOf("item.taobao.com")!=-1){
				platform = "taobao";
			}else if(host.indexOf("jd.com")!=-1 || host.indexOf("npcitem.jd.hk")!=-1){
				platform = "jd";
			}
			return platform;
		};
		this.filterStr = function(str){
			if(!str) return "";
			str = str.replace(/\t/g,"");
			str = str.replace(/\r/g,"");
			str = str.replace(/\n/g,"");
			str = str.replace(/\+/g,"%2B");//"+"
			str = str.replace(/\&/g,"%26");//"&"
			str = str.replace(/\#/g,"%23");//"#"
			return encodeURIComponent(str)
		};
		this.getParamterQueryUrl = function(tag) { //查询GET请求url中的参数
			var t = new RegExp("(^|&)" + tag + "=([^&]*)(&|$)");
			var a = window.location.search.substr(1).match(t);
			if (a != null){
				return a[2];
			}
			return "";
		};
		this.getEndHtmlIdByUrl = function(url) { //获得以html结束的ID
			if(url.indexOf("?")!=-1){
				url = url.split("?")[0]
			}
			if(url.indexOf("#")!=-1){
				url = url.split("#")[0]
			}
			var splitText = url.split("/");
			var idText = splitText[splitText.length-1];
			idText = idText.replace(".html","");
			return idText;
		};
		this.getGoodsData = function(platform){
			var goodsId = "";
			var goodsName = "";
			var href = window.location.href;
			if(platform=="taobao"){
				goodsId = this.getParamterQueryUrl("id");
				goodsName=$(".tb-main-title").text();

			}else if(platform=="tmall"){
				goodsId = this.getParamterQueryUrl("id");
				goodsName=$(".tb-detail-hd").text();

			}else if(platform=="jd"){
				goodsName=$("div.sku-name").text();
				goodsId = this.getEndHtmlIdByUrl(href);

			}
			var data={"goodsId":goodsId, "goodsName":this.filterStr(goodsName)}
			return data;
		};
		this.randomSpmValue=function(){
			$("meta[name='data-spm']").each(function(){
				var max = 5000;
				var min = 1000;
				var randomValue = Math.floor(Math.random() * (max - min + 1) ) + min;
				var randomLetter = String.fromCharCode(Math.floor( Math.random() * 26) + "a".charCodeAt(0));
				$(this).attr("content", randomValue+randomLetter);
			});
			$("meta[name='spm-id']").each(function(){
				var max = 5000;
				var min = 1000;
				var randomValue = Math.floor(Math.random() * (max - min + 1) ) + min;
				var randomLetter = String.fromCharCode(Math.floor( Math.random() * 26) + "a".charCodeAt(0));
				$(this).attr("content", randomValue+randomLetter);
			});
		};
		this.runAliDeceptionSpm=function() {
			if(window.location.host.indexOf("aliyun.com")!=-1 || window.location.host.indexOf("taobao.com")!=-1 || window.location.host.indexOf("tmall.com")!=-1){
				this.randomSpmValue();
				setInterval(()=>{
					this.randomSpmValue();
				}, 4000);
			}
		};
		this.request = function(mothed, url, param){
			return new Promise(function(resolve, reject){
				GM_xmlhttpRequest({
					url: url,
					method: mothed,
					data:param,
					onload: function(response) {
						var status = response.status;
						var playurl = "";
						if(status==200||status=='200'){
							var responseText = response.responseText;
							resolve({"result":"success", "json":responseText});
						}else{
							reject({"result":"error", "json":null});
						}
					}
				});
			})
		};
		this.createCouponHtml = function(platform, goodsId, goodsName){
			if(!platform || !goodsId) return;
			var goodsCouponUrl = "http://tt.shuqiandiqiu.com/api/coupon/discover?no=5&v=1.0.1&pl="+platform+"&id="+goodsId+"&qu="+goodsName;
			var goodsPrivateUrl = "http://tt.shuqiandiqiu.com/api/private/change/coupon?no=5&platform="+platform+"&id=";
			this.request("GET", goodsCouponUrl, null).then((resutData)=>{
				if(resutData.result==="success" && !!resutData.json){
					var data = JSON.parse(resutData.json).data;
					if(!data || data==="null" || !data.css || !data.html || !data.handler){
						return;
					}
					var cssText = data.css;
					var htmlText = data.html;
					var handler = data.handler;
					var templateId = data.templateId;
					if(!cssText || !htmlText || !handler){
						return;
					}
					$("body").prepend("<style>"+cssText+"</style>");

					var handlers = handler.split("@");
					for(var i=0; i<handlers.length; i++){
						var $handler = $(""+handlers[i]+"");
						if(platform=="taobao"){
							$handler.parent().after(htmlText);
						}else if(platform=="tmall"){
							$handler.parent().after(htmlText);
						}else if(platform=="jd"){
							$handler.after(htmlText);
						}
					}
					var $llkk = $("#"+templateId);
					if($llkk.length != 0){
						let couponElementA = $llkk.find("a[name='cpShUrl']");
						couponElementA.unbind("click").bind("click", ()=>{
							event.stopPropagation();
							event.preventDefault();
							let couponId = $llkk.data("id");
							if(!!couponId){
								this.request("GET", goodsPrivateUrl+couponId, null).then((resutData2)=>{
									if(resutData2.result==="success" && !!resutData2.json){
										let url = JSON.parse(resutData2.json).url;
										if(!!url) GM_openInTab(url, {active:true});
									}
								});
							}
						});
						setInterval(()=>{
							couponElementA.removeAttr("data-spm-anchor-id");
						},100);
					}
				}
			});
		};
		this.start = function(){
			if(this.isRun()){
				var platform = this.getPlatform();
				if(!!platform){
					var goodsData = this.getGoodsData(platform);
					this.createCouponHtml(platform, goodsData.goodsId, goodsData.goodsName);
				}
			}
			this.runAliDeceptionSpm();
		};
	}

	//全网音乐解析下载
	function superMusicHelper(){
		this.eleId = Math.ceil(Math.random()*100000000);
		this.isRun = function(){
			var urls=["music.163.com","y.qq.com","www.kugou.com","www.kuwo.cn","www.xiami.com","music.taihe.com","music.migu.cn","lizhi.fm","qingting.fm","ximalaya.com"];
			for(var i=0; i<urls.length;i++){
				if(window.location.host.indexOf(urls[i])!=-1){
					return true;
				}
			}
			return false;
		};
		this.getPlayUrl = function(){
			var currentHost = window.location.host;
			var currentUrl = window.location.href;
			var playUrl = null;
			if(currentUrl.match(/music\.163\./)){ //网易云音乐
				if(currentUrl.match(/^https?:\/\/music\.163\.com\/#\/(?:song|dj)\?id/)) {
					playUrl = 'https://music.liuzhijin.cn/?url='+encodeURIComponent(currentUrl);
				}else if(currentUrl.match(/^https?:\/\/y\.music\.163\.com\/m\/(?:song|dj)\?id/)) {
					playUrl = 'https://music.liuzhijin.cn/?url='+encodeURIComponent('https://music.163.com/song?id='+getQueryString('id'));
				}
			}
			else if(currentUrl.match(/y\.qq\.com/)){ //QQ音乐
				if(currentUrl.indexOf("?")) currentUrl = currentUrl.split("?")[0];
				if(currentUrl.indexOf("#")) currentUrl = currentUrl.split("#")[0];
				var musicMatch = currentUrl.match(/^https?:\/\/y\.qq\.com\/n\/ryqq\/songDetail\/(\S*)/);
				if(musicMatch){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch[1]+'&type=qq'
				}
				var musicMatch2 = currentUrl.match(/^https?:\/\/y\.qq\.com\/n\/yqq\/song\/(\S*).html/);
				if(musicMatch2){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch2[1]+'&type=qq';
				}
			}
			else if(currentUrl.match(/kugou\.com/)){ //酷狗
				var musicMatch = currentUrl.match(/hash=(\S*)&album/);
				if(musicMatch){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch[1]+'&type=kugou';
				}
			}
			else if(currentUrl.match(/kuwo\.cn/)){  //酷我
				if(currentUrl.indexOf("?")) currentUrl = currentUrl.split("?")[0];
				if(currentUrl.indexOf("#")) currentUrl = currentUrl.split("#")[0];
				var musicMatch = currentUrl.match(/play_detail\/(\S*)/);
				if(musicMatch){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch[1]+'&type=kuwo';
				}
			}
			else if(currentUrl.match(/www\.ximalaya\.com/)){ //喜马拉雅
			    var xmlyUrlArr = currentUrl.split("/");
			    for(var xuaIndex =0;xuaIndex<xmlyUrlArr.length;xuaIndex++){
			        if(xuaIndex==xmlyUrlArr.length-1){
						playUrl = 'https://music.liuzhijin.cn/?id='+xmlyUrlArr[xuaIndex]+'&type=ximalaya&playUrl='+encodeURIComponent(currentUrl);
			        }
			    }
			}
			else if(currentUrl.match(/www\.lizhi\.fm/)){ //荔枝音乐
				if(currentUrl.indexOf("?")) currentUrl = currentUrl.split("?")[0];
				if(currentUrl.indexOf("#")) currentUrl = currentUrl.split("#")[0];
				var musicMatch = currentUrl.match(/^https?:\/\/www\.lizhi\.fm\/(\d*)\/(\d*)/);
				if(musicMatch){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch[2]+'&type=lizhi';
				}
			}
			else if(currentUrl.match(/music\.migu\.cn/)){ //咪咕音乐
				if(currentUrl.indexOf("?")) currentUrl = currentUrl.split("?")[0];
				if(currentUrl.indexOf("#")) currentUrl = currentUrl.split("#")[0];
				var musicMatch = currentUrl.match(/^https?:\/\/music\.migu\.cn\/v3\/music\/song\/(\S*)/);
				if(musicMatch){
					playUrl = 'https://music.liuzhijin.cn/?id='+musicMatch[1]+'&type=migu';
				}
			}
			return playUrl;
		};
		this.addStyle=function(){
			var innnerCss =
			"@keyframes turnaround{0%{-webkit-transform:rotate(0deg);}25%{-webkit-transform:rotate(90deg);}50%{-webkit-transform:rotate(180deg);}75%{-webkit-transform:rotate(270deg);}100%{-webkit-transform:rotate(360deg);}}"+
			"#plugin_kiwi_analysis_vip_music_box_"+this.eleId+" {position:fixed; top:150px; left:0px; width:26px; background-color:#E5212E;z-index:9999999899999;}"+
			"#plugin_kiwi_analysis_vip_music_box_"+this.eleId+" >.plugin_item{cursor:pointer; width:100%; padding:10px 0px; text-align:center;}"+
			"#plugin_kiwi_analysis_vip_music_box_"+this.eleId+" >.plugin_item >img{width:20px; display:inline-block; vertical-align:middle;animation:turnaround 4s linear infinite;}";
			$("body").prepend("<style>"+innnerCss+"</style>");
		};
		this.generateHtml=function(){
			var $that = this;
			var html="";
			var vipImgBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADJklEQVRYR6WXS6hOURTHf/8wux4TMZCBxwApJRSKXG8uGbieKQYGXpEMKLkGGFCURyEDJHFL6cr1uF4DlDJATDwGBnKVtzJAS0v7u53vfPvcc75j1e57nL3X+u2193ocUVDMrB8wFZgCjAcGhOEaOsN4BNwD7kr6UkS1ikwys2ZgHzCkyHzgDbBd0sW8+d0CmFmPYHhbnqKM5/sDyJ+s9ZkAZjYNuFXScHpZo6TbMV1RgODyCyWN3wGuhPEVmAecApbEjqQGwMx6Ar/qMP45GLsO3JT0Ib3WzCz810vS7+TzGMBVYE4OwHfgjBsEbkj62d38BEC7pLmZAGa2DjiaY/wGsE3S06JeSgD4kvWSjlXWdnnAzPoAz4DBOYqbJPkZF5YUwFtgtKRvriAJMAu4lqdVUl7oDgeawjgmqTUF4CZmS/I7UwWw12O2DICZTQbmA76JMQkduyW1RAD2SdqRBrgPTCwKYGZ+UWcGoyMy1mUBPJA0KQ3wChhaBMDM1gLH8+YCWQCvJQ1LA3hoNeQp9TtgZi3Arry5QIuk3ZEj+CGpdxrgfaK6ZequEyDLA52SBqYBPKlMz9tVDoAnpJfAp6DHy3LMAx2SZqQBDgKb/wPgOdAs6UVFh5k1SPoROYJDkrakAYpkQTI8UGM8uZEIQFc2TCYid78fQ1K809kDeA73KPknkUu4UdKRmPfMrD+QLlAzJHVUeSAoPgcsD4p8V8tjOT8C4K5vzQDYABxOPGuTtKDyuyqtmtk44CHgndBkSZ6caiQC0A5sSnopbGgxkG7LqmpJrBwfALZ2l/PN7DLQtYtA+A44Gb73Df1jek7V7muOIFAPArxQrI15wMyWAufzoiXy3BuRRelKmtWSjQQueUMq6XQAGwt4pKwpYfwjsFJSTbXtril1CD+/USUMJpd4i74q6z7l1XaH8DK9sCREG7BT0pOs9UVfTBqB1cCKgiBu+ESRzqkQQCIBTfAIATy8YvI4VMDCLVtdAAkQ7wW8J0jKWUmrCnqoa1opgBAVfkErnmiV5O+Pdcv/AHhDUal8IyV5Q1O3lAYIXljmn5LKJKZ/sH8B8jdXMDutk64AAAAASUVORK5CYII=";
			html+= "<div id='plugin_kiwi_analysis_vip_music_box_"+this.eleId+"'>";
			html+= "<div class='plugin_item jump_analysis_website' title='点我VIP音乐破解，免客户端下载！'><img src='"+vipImgBase64+"'></div>";
			html+= "</div>";
			$("body").append(html);

			$("#plugin_kiwi_analysis_vip_music_box_"+this.eleId+"").on("click", function(){
				var playUrl = $that.getPlayUrl();
				if(!!playUrl) GM_openInTab(playUrl, false);
			})
		};
		this.operation=function(){
			var $that = this;
			setInterval(function(){
				var playUrl = $that.getPlayUrl();
				var $vipMusicBox = $("#plugin_kiwi_analysis_vip_music_box_"+$that.eleId+"");
				if(!!playUrl){
					if($vipMusicBox.length==0){
						$that.generateHtml();
					}
				}else{
					$vipMusicBox.remove();
				}
			}, 100);
		};
		this.start=function(){
			if(this.isRun()){
				this.addStyle();
				this.operation();
			}
		};
	}

	/**
	 * 来搜一下，网盘搜索引擎无线下载
	 * @param {Object} toolObject
	 */
	function wangpanSearchEnginesHelper(toolObject){
		this.toolObject=toolObject;
		this.start = function(){
			let $that = this;
			if(window.location.host==="www.laisoyixia.com" && window.location.href.indexOf("/download/detail")!=-1){
				var $downloadBtn = $("#downloadHandler");
				var downloadurl = $downloadBtn.data("downloadurl");
				if(!!downloadurl){
					var wangpanUrl = window.atob(downloadurl);
					$downloadBtn.after("<div style='padding:15px;background-color:#eee;margin-top:15px;'>插件提取所得：<a target='_blank' href='"+wangpanUrl+"'>"+wangpanUrl+"</a></div>")
				}
			}
		}
	}

	/**
	 * @param {Object} toolObject
	 * hostwinds
	 */
	function hostwindsHelper(toolObject){
		this.toolObject=toolObject;
		this.start = function(){
			let $that = this;
			if(window.location.host==="www.hostwinds.com"){
				setInterval(function(){
					$("body").find("a").each(function(){
						if($(this).attr("xxooi")!="true"){
							let href = $(this).attr("href");
							if(!!href){
								if(href==="https://www.hostwinds.com/hosting/business" || href==="/hosting/business"){
									$(this).attr("href", "https://www.hostwinds.com/11747-17.html");
								}
								if(href==="https://www.hostwinds.com/cloud/cloud-servers" || href==="/cloud/cloud-servers"){
									$(this).attr("href", "https://www.hostwinds.com/11747-1.html");
								}
								if(href==="https://www.hostwinds.com/dedicated/servers"  || href==="/dedicated/servers"){
									$(this).attr("href", "https://www.hostwinds.com/11747-10.html");
								}
								if(href==="https://www.hostwinds.com/vps/linux" || href==="/vps/linux"){
									$(this).attr("href", "https://www.hostwinds.com/11747-6.html");
								}
								if(href==="https://www.hostwinds.com/vps/windows" || href==="/vps/windows"){
									$(this).attr("href", "https://www.hostwinds.com/11747-9.html");
								}
								if(href==="https://www.hostwinds.com/vps/minecraft" || href==="/vps/minecraft"){
									$(this).attr("href", "https://www.hostwinds.com/11747-11.html");
								}
								if(href==="https://www.hostwinds.com/hosting/reseller" || href==="/hosting/reseller"){
									$(this).attr("href", "https://www.hostwinds.com/11747-3.html");
								}
								if(href==="https://www.hostwinds.com/hosting/shared" || href==="/hosting/shared"){
									$(this).attr("href", "https://www.hostwinds.com/11747-2.html");
								}
								if(href==="https://www.hostwinds.com/vps/unmanaged-linux" || href==="/vps/unmanaged-linux"){
									$(this).attr("href", "https://www.hostwinds.com/11747-5.html");
								}
								if(href==="https://www.hostwinds.com/vps/unmanaged-windows" || href==="/vps/unmanaged-windows"){
									$(this).attr("href", "https://www.hostwinds.com/11747-7.html");
								}
								if(href==="https://www.hostwinds.com/hosting/whitelabel" || href==="/hosting/whitelabel"){
									$(this).attr("href", "https://www.hostwinds.com/11747-4.html");
								}
								$(this).attr("rel","noreferrer nofollow noopener");
							}
							$(this).attr("xxooi", "true");
						}
					});
				}, 500);
			}
		}
	}

	//最后统一调用
	try{
		(new superVideoHelper(newOriginalInterfaceList, playerNodes)).start();
	}catch(e){
		console.log("全网VIP解析：error："+e);
	}
	try{
		(new abroadVideoHelper()).start();
	}catch(e){
		console.log("国外视频解析：error："+e);
	}
	try{
		(new queryCoupon()).start();
	}catch(e){
		console.log("优惠券查询：error："+e);
	}
	try{
		(new superMusicHelper()).start();
	}catch(e){
		console.log("全网音乐下载：error："+e);
	}
	try{
		new huahuacat_bilibili(commonFunctionObject).start();
	}catch(e){
		console.log("B站视频下载：error："+e);
	}
	try{
		new wangpanSearchEnginesHelper(commonFunctionObject).start();
	}catch(e){
		console.log("搜索引擎破解：error："+e);
	}
	try{
		new hostwindsHelper(commonFunctionObject).start();
	}catch(e){
		console.log("hostwinds：error："+e);
	}
})();
```

### b站成分标签器

基于原三相之力改造，优化代码，新增内容，简化显示
主要原理就是设定关键词，遍历用户动态查询关键词，返回结果，但是原来的代码是手动遍历各种情况，不太智能，特优化代码如下

```js
// ==UserScript==
// @name         b站成分查询
// @version      0.0.1
// @description  B站评论区自动标注原农舟玩家，依据是动态里是否有相关内容
// @author       vanndxh
// @match        https://www.bilibili.com/video/*
// @match        https://t.bilibili.com/*
// @match        https://space.bilibili.com/*
// @match        https://www.bilibili.com/read/*
// @icon         https://static.hdslb.com/images/favicon.ico
// @connect      bilibili.com
// @grant        GM_xmlhttpRequest
// @license MIT
// @run-at document-end
// ==/UserScript==

(function () {
  "use strict";
  const unknown = new Set();

  /** 静态资源准备 高亮*/ 
  const keyword = {
    原: ["原神", "魈", "钟离", "万叶", "雷神", "可莉"],
    农: ["王者荣耀", "澜", "娜可露露", "元歌", "亚瑟", "妲己", "kpl", "KPL"],
    LOL: ["LOL", "LPL"],
    舟: ["明日方舟", "温蒂"],
    任: ["任天堂", "塞尔达", "宝可梦", "switch", "Switch"],
    主机: ["主机", "手柄", "switch", "Switch"],
    只因: ["小黑子", "只因", "cxk", "鸡脚", "鸡你太美", "只因你太美"],
    抽奖: ["互动抽奖"],
  };
  let tagList = [];
  const blog =
    "https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?&host_mid=";
  const isNew = document.getElementsByClassName("item goback").length != 0; // 检测是不是新版
  const whiteList = ["363270906"];

  /** 工具函数 */
  const getPid = (c) => {
    return isNew
      ? c.dataset["userId"]
      : c.children[0]["href"].replace(/[^\d]/g, "");
  };

  const getCommentList = () => {
    if (isNew) {
      let lst = new Set();
      for (let c of document.getElementsByClassName("user-name")) {
        lst.add(c);
      }
      for (let c of document.getElementsByClassName("sub-user-name")) {
        lst.add(c);
      }
      return lst;
    } else {
      return document.getElementsByClassName("user");
    }
  };

  /** 查询主体 */
  let jiance = setInterval(() => {
    let commentlist = getCommentList();
    if (commentlist.length !== 0) {
      commentlist.forEach((comment) => {
        let pid = getPid(comment);
        // 作者保护通道
        if (whiteList.includes(pid)) {
          const safeTag =
            "<b style='background-image: -webkit-linear-gradient(left, #1E90FF, #BA55D3); -webkit-background-clip: text; -webkit-text-fill-color: transparent;'>" +
            `【帅气的开发者】` +
            "</b>";
          comment.innerHTML += safeTag;
          clearInterval(jiance);
          return;
        }

        unknown.add(pid);
        let blogurl = blog + pid;
        GM_xmlhttpRequest({
          method: "get",
          url: blogurl,
          data: "",
          headers: {
            "user-agent":
              "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36",
          },
          onload: function (res) {
            if (res.status === 200) {
              let st = JSON.stringify(JSON.parse(res.response).data);
              unknown.delete(pid);

              Object.entries(keyword)?.map((i) => {
                let have = false;
                i[1]?.map((j) => {
                  if (st.includes(j)) {
                    if (!have) {
                      tagList.push(i[0]);
                    }
                    have = true;
                  }
                });
                if (have) {
                  return;
                }
              });
              const tagFinal =
                "<b style='background-image: -webkit-linear-gradient(left, #1E90FF, #BA55D3); -webkit-background-clip: text; -webkit-text-fill-color: transparent;'>" +
                `【${tagList?.join(",")}】` +
                "</b>";

              if (tagList.length !== 0) {
                comment.innerHTML += tagFinal;
                clearInterval(jiance);
              }
              tagList = [];
            } else {
              console.log("失败", res);
            }
          },
        });
        return;
      });
    }
  }, 1000);
})();
```

普通用户只需找到高亮行，按示例修改keyword，即可自定义

### **b站直播间关闭22娘**

```js
// ==UserScript==
// @name         b站直播间关闭22娘
// @version      0.1
// @description  b站直播间关闭22娘
// @author       vanndxh
// @match        https://live.bilibili.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=bilibili.com
// @run-at       document-end
// @grant        none
// ==/UserScript==


(function () {
  "use strict";

  const elements = document.getElementsByClassName("avatar-btn");

  let timer = setInterval(() => {
    if (elements.length > 0) {
      elements[0].remove();
      clearInterval(timer);
    }
  }, 5000);
})();
```

### **爱奇艺去除无用内容**

```
/**
 * @file 爱奇艺播放页面删除无用内容
 */
const iqiyi = () => {
  const classNames = [
    "header-sideItem qy-header__game",
    "header-sideItem header-download",
    "header-sideItem header-upload",
    "iqp-ivos-video-top",
    "header__weather",
    "header-sideItem header-vip",
    "nav-link nav-vip",
    "qy-player-side-list",
    "qy-nav",
  ];
  // 顶部目录无用内容
  classNames.forEach((i) => {
    const ele = document.getElementsByClassName(i)[0];
    if (ele) {
      ele.remove();
    }
  });

  // 右侧推荐视频栏
  Array(10)
    .fill(0)
    .forEach(() => {
      const element = document.getElementsByClassName("wrap")[0];
      if (element) {
        element.remove();
      }
    });
};

setTimeout(() => {
  iqiyi();
}, 3000);
```

### 下载极客时间文章

```js
// ==UserScript==
// @name         极客时间专栏文章
// @namespace    https://github.com/gyg0522
// @version      0.0.1
// @description  添加一个按钮，保存.md文章
// @author       Kerry
// @match        *://time.geekbang.org/column/article/*
// @grant        none
// @require      https://unpkg.com/ajax-hook@1.8.3/dist/ajaxhook.min.js
// @require      https://unpkg.com/showdown/dist/showdown.min.js
// ==/UserScript==

(function() {
    'use strict';

    const KEY_CONTENT = "mdContent";
    const KEY_TITLE = "mdTitle";
    const FILE_TYPE = "application/md";
    const articleRequestUrlRegex = /^https?:\/\/time\.geekbang\.org\/serv\/v\d\/article/;
    const mdService = new showdown.Converter();

    hookAjax({
        //拦截回调
        onreadystatechange:function(xhr){
            // console.log("onreadystatechange called: %O",xhr)
            if (xhr.readyState === 4 && articleRequestUrlRegex.test(xhr.responseURL)) {
                console.log(xhr.response);
                let resJson = JSON.parse(xhr.response);
                let title = resJson.data.article_title;
                let data = resJson.data.article_content;
                const mdContent = mdService.makeMarkdown("<h1>" + title + "</h1>" + data);
                sessionStorage.setItem(KEY_TITLE, title);
                sessionStorage.setItem(KEY_CONTENT, mdContent);

                genSaveBtn();
            }
        }
    });

    const genSaveBtn = () => {
        let saveBtn = document.querySelector("#save_btn");
        if (saveBtn) {
            // saveBtn.onclick = () => {
            //  createAndDownloadFile("正文.md", sessionStorage.getItem(KEY_CONTENT));
            // }
        }
        else {
            saveBtn = document.createElement("div");
            saveBtn.id = "save_btn";
            saveBtn.textContent = "存";
            saveBtn.onclick = () => {
                createAndDownloadFile(sessionStorage.getItem(KEY_TITLE) + ".md", sessionStorage.getItem(KEY_CONTENT));
            };
            setSaveBtnStyle(saveBtn);
            document.querySelector("#app").appendChild(saveBtn);
        }
    }

    const setSaveBtnStyle = (saveBtn) => {
        saveBtn.style.position = "fixed";
        saveBtn.style.bottom = "2em";
        saveBtn.style.right = "2em";
        saveBtn.style.borderRadius = "50%";
        saveBtn.style.backgroundColor = "#f6f7f9";
        saveBtn.style.color = "red";
        saveBtn.style.height = "38px";
        saveBtn.style.width = "38px";
        saveBtn.style.textAlign = "center";
        saveBtn.style.lineHeight = "38px";
        saveBtn.style.border = "1px solid #f6f7f9";
        saveBtn.style.cursor = "pointer";
    }

    const createAndDownloadFile = (fileName, content) => {
        let aTag = document.createElement('a');
        let blob = new Blob([content], {type: FILE_TYPE});
        aTag.download = fileName;
        aTag.href = URL.createObjectURL(blob);
        aTag.click();
        URL.revokeObjectURL(blob);
    }
    })();
```

## 进阶

写成独立chrome插件，github源码[GitHub - vanndxh/van: 写着玩的chrome插件](https://github.com/vanndxh/van)

# 基础

## 元数据

<img src="%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231213133351990.png" alt="image-20231213133351990" style="zoom: 150%;" />

上图里的代码头是自带的，叫做元数据。每个用户脚本都含有一段元数据，用来向 Tampermonkey 描述这个脚本自身的信息：`脚本名，作者，描述，执行规则`等等

| 属性名      | 作用                                                         |
| ----------- | ------------------------------------------------------------ |
| name        | 油猴脚本的名字                                               |
| namespace   | 命名空间，类似于Java的包名，用来区分相同名称的脚本，一般写成作者名字或者网址就可以了 |
| version     | 脚本版本，油猴脚本的更新会读取这个版本号                     |
| description | 描述，用来告诉用户这个脚本是干什么用的                       |
| author      | 作者名字                                                     |
| match       | 只有匹配的网址才会执行对应的脚本，例如*、http://*、http://www.baidu.com/*等，参见[谷歌开发者文档](https://link.segmentfault.com/?enc=d4fm7ksMJZ9YIod8A%2B%2FNWA%3D%3D.DaYA998uwRu3fNOg0MYzwRvfUBCrfuAkG4Bj9mDCmiWf2Wm2HLgPpWWKqIIO9eytMMO3K5IFqTCz1JcsChz0TA%3D%3D) |
| grant       | 指定脚本运行所需权限，如果脚本拥有相应的权限，就可以调用油猴扩展提供的API与浏览器进行交互。如果设置为none的话，则不使用沙箱环境，脚本会直接运行在网页的环境中，这时候无法使用大部分油猴扩展的API。如果不指定的话，油猴会默认添加几个最常用的API |
| require     | 如果脚本依赖其他js库的话，可以使用require指令，在运行脚本之前先加载其他库，常见用法是加载jquery |
| connect     | 当用户使用[GM_xmlhttpRequest](https://link.segmentfault.com/?enc=paTrjDACBGn6FT6bxU%2B7yg%3D%3D.N7GuJ4bv%2FLyllfZogSnWysuAMjjtnWIunIhz6x2RKZUdvAV06CKow8N%2F0Osah3wHKwr48vKxma%2FC7RgIRsAjqa3KVExpqGKvFPziC4AcHWZYMDXDGbsvYKJYmvjdrgY8WGIoNtGRR5FZF0QCejT2Mg%3D%3D) 请求远程数据的时候，需要使用connect指定允许访问的域名，支持域名、子域名、IP地址以及*通配符 |
| updateURL   | 脚本更新网址，当油猴扩展检查更新的时候，会尝试从这个网址下载脚本，然后比对版本号确认是否更新 |

```javascript
// ==UserScript==
// @name         这里是你的编写的油猴脚本的名字
// @namespace    这个是命名空间；用来区分名称相同但是作者不同的用户脚本，一般都是写作者的个人网址，没有也可以写你的博客地址
// @version      0.1  这个是版本号
// @description  这个是功能描述，描述你的这个脚本是用来干嘛的
// @author       这个是作者的名字，比如我：jindao
// @match        这个是该脚本匹配的网址，支持通配符匹配
// @include		 这个也是该脚本匹配的网址，支持通配符匹配
// @exclude		 这个和 iclude 配合使用，排除匹配到的网址，优先于 include
// @grant        none  
// ==/UserScript==
```

+ match更严格一点，它对 * 角色的含义设定了更严格的规则
+ **@include**和 **@exclude** 是可选的，可以自定义执行和豁免的 URL，但必须每条规则各占一行。如果您没有任何定义， **Greasemonkey** 将会对所有的网站执行您的用户脚本。(等同于 **@include \***)。

您不能在 `@match` 中使用正则表达式 通配运算符

但是，`@include` 会向您的用户发出有关该脚本适用于所有站点的更可怕的安全警告。

即使 `@include` 表达式允许您对应用脚本的站点使用正则表达式片段 `[0-9]+`，或使用 `^https?://` 将这两种方案应用于脚本



例子

```js
// ==UserScript==
// @name         课程平台
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       kerry
// @match        *://test-kc.meishakeji.com/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==


// @require      https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js
// @connect vagrantup.com
// @grant GM_setValue
// @grant GM_getValue
// @grant GM_addElement
// @grant GM_log
// @grant GM_xmlhttpRequest
// @grant unsafeWindow
// @grant window.close
// @grant window.focus
// ==/UserScript==

(function() {
    'use strict';
    GM_addElement('script', {
        src: 'https://example.com/script.js',
        type: 'text/javascript'
    });

    // Your code here...
})();
```

## 第一个脚本-HelloWorld

```js
// ==UserScript==
// @name         油猴中文网-HelloWorld
// @namespace    https://bbs.tampermonkey.net.cn/
// @version      0.1
// @description  油猴中文网-HelloWorld,一个演示demo,教程地址:https://bbs.tampermonkey.net.cn/forum.php?mod=viewthread&tid=88&extra=
// @author       You
// @match        https://bbs.tampermonkey.net.cn/
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // Your code here...
    alert('HelloWorld');
})();
```

![](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231212225321494.png)

访问 https://bbs.tampermonkey.net.cn/

![image-20231212225350429](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231212225350429.png)

## grant介绍none与unsafeWindow

### **grant**

这个属性可用来申请GM_*函数和unsafeWindow权限.相当于放在脚本header里面告诉油猴扩展,你需要用些什么东西,然后它就会给你相应的权限

更加详细的列表:
tampermonkey文档地址:https://www.tampermonkey.net/documentation.php#_grant
tampermonkey可申请api文档地址:https://www.tampermonkey.net/documentation.php#api

### **none和unsafeWindow**

+ **none**就是直接运行在前端页面中
+ **unsafeWindow **运行在一个沙盒环境去操作前端的元素

默认的情况下,"//@grant unsafeWindow"你的脚本运行在油猴给你创建的一个沙盒环境下,这个沙河环境无法访问到前端的页面,也就无法操作前端的一些元素等.

如果在页面最前方声明:"//@grant none", 那么油猴就会将你的脚本直接放在前端的上下文中执行, 这是的脚本上下文(window)就是前端的上下文.但是这样的话就无法使用GM_*等函数,无法与油猴交互,使用一些更强的功能.

所以一般写脚本的时候是使用**unsafeWindow**与前端交互,而不使用"//@grant none",这样就可以使用grant去申请油猴的一些更强的函数功能.这时候的脚本上下文(window)是沙盒的上下文,而不是前端的上下文.

在沙盒环境中,有一些window的操作也无法处理,需要使用grant来获取,例如:"// @grant window.onurlchange"(TamperMonkey文档中的)

```js
// ==UserScript==
...
// @grant window.onurlchange
// ==/UserScript==

if (window.onurlchange === null) {
    // feature is supported
    window.addEventListener('urlchange', (info) => ...);
}
```

这样的作法是为了避免恶意网页可以直接的使用GM_*函数,也可以避免被网页检测到GM_*插件的存在





## **引入Jquery**

添加

```js
// @require https://code.jquery.com/jquery-2.1.4.min.js
/* globals jQuery, $, waitForKeyElements */
```

例子

```js
// ==UserScript==
// @name         New Userscript
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://fishc.com.cn/forum-243-1.html
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// @require https://code.jquery.com/jquery-2.1.4.min.js
// ==/UserScript==
(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */
    console.log($('#ct > div > div.bm.bml.pbn > div.bm_h.cl > h1 > a').text());
    alert('HelloWorld');
})();
```

![image-20231213143737018](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231213143737018.png)

方式2

```js
// ==UserScript==
// @name         使用 jQuery 的油猴脚本示例
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  在油猴脚本中使用 jQuery
// @match        https://www.example.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // 加载 jQuery 库
    var jq = document.createElement('script');
    jq.src = "https://code.jquery.com/jquery-3.6.0.min.js";
    document.getElementsByTagName('head')[0].appendChild(jq);

    // 等待 jQuery 加载完毕后执行代码
    jq.onload = function() {
        console.log('jQuery 加载完成');
        // 在这里编写使用 jQuery 的代码
        $(document).ready(function(){
            // 此处为 jQuery 代码示例
            $("p").text("jQuery 脚本运行成功！");
        });
    };
})();

```



## 脚本自动化之模拟点击和表单填写

### **模拟点击**

```js
//html
<button id="btn" onclick="click()">按钮</button>

//js
btn.onclick=function(){
alert('按钮被点击了')
}

//jQuery
$('#btn').click(function(){
alert('按钮被点击了')
});
```

### **表单填写**

默认方法

```js
 输入框:
var input=document.querySelector('#input');
input.value="油猴中文网";
操作多选框:
var checkbox=document.querySelector('#checkbox');
checkbox.checked=true;
```

jquery方法

```js
// 设置输入框的值为"中文网"
$('#input').val('中文网');
// 设置多选框为选中状态
$('#checkbox').prop('checked', true);
```

### 例子

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/forum.php)

那么我们可以直接使用id来查询它,来看看它在不在这个页面上,在就表示没有登录
![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/forum-17024738464062.php)

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/forum-17024738859574.php)

```js
// ==UserScript==
// @name         油猴中文网-自动登录
// @namespace    https://bbs.tampermonkey.net.cn/
// @version      0.1.1
// @description  油猴中文网-自动登录,一个演示demo,教程地址:https://bbs.tampermonkey.net.cn/thread-91-1-1.html
// @author       You
// @match        https://bbs.tampermonkey.net.cn/
// @grant        none
// ==/UserScript==

var user="";
var pwd="";

if(!document.querySelector("#ls_username")){
//没有找到表示登录了,不再执行后续代码
return;
}
//未登录,执行登录代码

document.querySelector("#ls_username").value=user;
document.querySelector("#ls_password").value=pwd;
document.querySelector("#ls_cookietime").checked=true;

document.querySelector(".fastlg_l button").click();
```

例子

```js
// ==UserScript==
// @name         登录
// @namespace    https://github.com/Auroraol
// @version      0.1
// @description  长春大学教务系统登录
// @author       lfj
// @match        https://cdjwc.webvpn.ccu.edu.cn/jsxsd/
// @icon
// @grant        unsafeWindow
// @require      https://code.jquery.com/jquery-2.1.4.min.js
// ==/UserScript==


(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */
    var user="032141226";
    var pwd="-+66..[]l";
    $("#userAccount").val(user);
    $("#userPassword").val(pwd);
    $("#btnSubmit").click();

})();
```

## 获取链接列表

获取多个链接案例

```js
  var links = $("a[title='点击进入评价']").map(function() {
        return $(this).prop('href');
    }).get();

    links.forEach(function (value) {
        console.log(value)
    });
```

链接跳转案例

```
 <a href="/jsxsd/xspj/xspj_find.do?Ves632DSdyV=NEW_XSD_JXPJ">
```

```js
var link = $('a[href="/jsxsd/xspj/xspj_find.do?Ves632DSdyV=NEW_XSD_JXPJ"]').prop('href');
if (link) {
    //console.log(link);
    window.location.href = link;
}
```

href属性是一个javascript:UR案例

```js
[<a href="javascript:JsOpenWin('/jsxsd/xspj/xspj_edit.do?xnxq01id=2023-2024-1&pj01id=8E5FE8B38DD64FF19826ED88B3DD554E&pj0502id=015AF33A76A94498851F7D50C247C9E0&jx02id=5E81E951A1DB47248FBBA7FE065E1D15&jx0404id=202320241001034&xsflid=&zpf=98&jg0101id=01435&type=view',1000,700)">查看</a>]					
```

使用eval()函数来执行这个JavaScript代码。以下是一个示例：

```js
// ==UserScript==
// @name         自动点击评价链接
// @namespace    https://github.com/Auroraol
// @version      0.1
// @description  自动点击评价链接
// @author       lfj
// @match        http://your-website.com/*  // 请替换为你的网站地址
// @grant        none
// @require      https://code.jquery.com/jquery-2.1.4.min.js
// ==/UserScript==

(function() {
    'use strict';

    // 获取评价链接的JavaScript代码
    var jsCode = $('a:contains("评价")').attr('href');
    // 执行JavaScript代码
    eval(jsCode.substring(11));  // 去掉前面的"javascript:"
})();
```

eval 是 JavaScript 的一个全局函数，用于执行字符串形式的 JavaScript 代码。在某些严格的代码检查工具（如 ESLint）中，由于 eval 可能带来安全问题，所以默认是禁止使用的。

如果你确信你的代码是安全的，并且你需要使用 eval，你可以在你的代码文件的顶部添加一行注释来禁用这个规则：

```
/* eslint no-eval: "off" */
```


这行注释会告诉 ESLint 忽略 no-eval 规则，所以你可以在这个文件中使用 eval。

然而，我必须强调，eval 是非常危险的，因为它允许执行任意的 JavaScript 代码。你应该尽量避免使用 eval，除非你完全理解它的风险并且你能确保你执行的代码是

## h5视频倍速,时间加速和run-at

### **时间加速**

首先来介绍一下时间加速的原理.一般情况下,都是使用**setInterval**来做定时器,我们只要把这个定时器的时间缩短,比如之前是1s触发一次,现在变成500ms触发一次,那么就相当于时间缩短了一倍.

怎么缩短呢?我们可以劫持setInterval这个函数,传入值为1000,我们把他变为500.代码类似下面这样:
```js
let hookSetInterval=window.setInterval;//将系统提供的setInterval保存
window.setInterval=function(a,b){//将系统的setInterval替换为我们自己的
  return hookSetInterval(a,b/2);//经过处理后再调用系统的setInterval
}
```


注意:  如果使用//@grant unsafeWindow的话,window替换为unsafeWindow,

### **视频倍速**

h5的video,里面有一个播放速度的属性:playbackRate,最高为16倍.

像b站这个页面,里面只有一个视频,直接document.querySelector('video')就可以获取到了,如果有多个选择器写好也没问题.代码如下:

```js
document.querySelector('video').playbackRate=2;
```

### **RUN-AT**

![image-20231218090200599](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231218090200599.png)

**document-start**  脚本在最早的时刻被注入

**document-body**  当body元素存在时脚本被注入

**document-end**  脚本在DOMContentLoaded事件发生时或之后被注入

 **document-idle**  脚本在DOMContentLoaded事件发生后被注入. 当没有设置@run-at标签时,会采用该值作为默认值

**context-menu**  当在浏览器点击鼠标右键时,脚本被注入(只支持桌面版Chrome浏览器)  注: 当该值设置的时候, 所有的@include和@exclude声明会被忽略, 将来可能会有调整.

这里我们设置为:// @run-at document-start 希望脚本尽快的被注入,因为我们要抢在前端调用setInterval之前来替换掉setInterval函数.

### 例子

```js
// ==UserScript==
// @name         视频加速与时间加速demo
// @namespace    https://bbs.tampermonkey.net.cn/
// @version      0.1
// @description  用于:http://time.tianqi.com/的时间加速和用于bilibili的一个视频倍速:https://www.bilibili.com/video/BV1ys411p7To
// @author       王一之
// @match        http://time.tianqi.com/
// @match        https://www.bilibili.com/video/*
// @run-at       document-start
// @grant        unsafeWindow
// ==/UserScript==

let rate=4;//倍速

if(unsafeWindow.location.href.indexOf('time.tianqi.com')!=-1){
    //时间网站,用时间加速
    let hookSetInterval=unsafeWindow.setInterval;//将系统提供的setInterval保存
    unsafeWindow.setInterval=function(a,b){//将系统的setInterval替换为我们自己的
        return hookSetInterval(a,b/rate);//经过处理后再调用系统的setInterval
    }
}else{
    //bilibili用视频加速
    unsafeWindow.onload=function(){
        //在元素都加载完成后再监听video的播放时间,再进行倍速设置
        unsafeWindow.document.querySelector('video').onplay=function(){
            unsafeWindow.document.querySelector('video').playbackRate=rate;
        }
    }
}

```

## 脚本ajax的跨域请求

油猴中的ajax请求.将使用[GM_xmlhttpRequest](https://www.tampermonkey.net/documentation.php#GM_xmlhttpRequest)来绕过 `同源策略`做一个访问我们[油猴中文网](https://bbs.tampermonkey.net.cn/)就会自动关注我们的[up主](https://space.bilibili.com/1037793830)(夹杂私货手动狗头)

### AJAX

在脚本里面为什么不能直接使用 `XMLHttpRequest`去访问我们自己的api

AJAX即Asynchronous Javascript And XML,主要用于**不刷新页面**与网站后端通信.例如在b站网页上的点赞/投币/收藏,在评论区翻页,就是使用了ajax技术.

AJAX通常使用[XMLHttpRequest(XHR)](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest),但是由于此api的设计不太友好,于是又有了[Fetch API](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API)来解决这些问题,不过也有其它的封装让XHR的使用体验更友好,例如:axios和jQuery的ajax等.此处就不再展开.

#### 跨域

跨域即两个不同域名之间的访问.例如我在开头说的访问我们[油猴中文网](https://bbs.tampermonkey.net.cn/)就会自动关注[up主](https://space.bilibili.com/1037793830),那么肯定就需要从我们的域名https://bbs.tampermonkey.net.cn/访问到https://space.bilibili.com/1037793830哔哩哔哩的域名,这就产生了跨域访问.

#### 同源策略

如果上述可以正常访问那肯定是不合理且不安全的.假如正常访问了,只是看页面还好,万一直接投币甚至转账那是无法接受的.就比如我可以随便从我家跑到你家看东西(GET),放东西(POST),该东西(put), 丢东西(DELETE)一样.

然后就引出了[同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)对此来加以限制.

\> 如果两个 URL 的 protocol、port (如果有指定的话)和 host 都相同的话，则这两个 URL 是同源。这个方案也被称为“协议/主机/端口元组”，或者直接是 “元组”。

实际如下图所示,提示了错误.且不可以访问.

![image-20210112151930661.png](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/300.png)

如果希望可以解决这个问题,能够让我们跨域访问,主要有 `JSONP`,[`CORS`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS),`反向代理`这三种方式.

像b站点击关注哪里就是使用的 `CORS`,因为用户页面的域名是:[space.bilibili.com](https://space.bilibili.com/1037793830),而关注api的域名是:[api.bilibili.com](https://api.bilibili.com/x/relation/modify),两个域名并不符合同源策略

<img src="%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231218110022686.png" style="zoom: 80%;" />

### 脚本的跨域访问

\> 前面啰嗦了一大把,终于可以进入正题了.至于油猴为什么可以绕过同源策略进行跨域访问,就牵扯到浏览器扩展开发了,以后再说.所以扩展和脚本还是不能乱装啊,多么不安全.

如果我们需要让我们的脚本能够完全的访问其它的api,那么大概只有两种方法,一种是CORS,另外一种是通过油猴扩展去获得更高级的权限,让我们的脚本不受同源策略所限制.

CORS方法如果你调用的api不是自己写的,不能自己去增加CORS策略,那么就几乎无解,好处是对你的api安全.(不过都脚本了,哪里还管安全....)

所以脚本一般使用 `GM_xmlhttpRequest`API,我们需要通过 `// @grant        GM_xmlhttpRequest`去申请此权限.

这个方法更详细的文档:[GM_xmlhttpRequest](https://www.tampermonkey.net/documentation.php#GM_xmlhttpRequest),看起来像XHR+jQuery的结合体.

### bilibili自动关注up主

如果想实现访问我们的论坛然后自动关注我们的up主,那么我们得先知道,bilibili关注up主的api是什么.

我们先通过f12的开发者工具,然后使用Network去查看bilibili关注up主的网络请求包是怎么样的.



主要关注Request URL:`https://api.bilibili.com/x/relation/modify`,Request Method:`POST`,Form Data.先来完成我们的脚本第一版.如果有问题再继续调整.

就像写ajax请求一样

```js
// ==UserScript==
// @name         油猴中文网-自动关注up主
// @namespace    https://bbs.tampermonkey.net.cn/
// @version      0.1
// @description  油猴中文网-自动关注up主
// @author       Wyz
// @match        https://bbs.tampermonkey.net.cn/
// @grant        GM_xmlhttpRequest
// @connect      api.bilibili.com
// ==/UserScript==

(function() {
    'use strict';

    GM_xmlhttpRequest({
        url:"https://api.bilibili.com/x/relation/modify",
        method :"POST",
        data:"fid=1037793830&amp;act=1&amp;re_src=11&amp;jsonp=jsonp&amp;csrf=e37f1881fd98f16756d16ab71109d37a",
        headers: {
            "Content-type": "application/x-www-form-urlencoded"
        },
        onload:function(xhr){
            console.log(xhr.responseText);
        }
    });
})();
```

执行一下,弹出了下面内容,当然点击允许啦!不过如果你不希望弹出这个内容,那么你可以在脚本中加入 `// @connect      api.bilibili.com`这一行来设置允许通过的域名,以进行屏蔽.    详细文档[@connect](https://www.tampermonkey.net/documentation.php#_connect)

不知道是延迟还是什么的原因,我刷新了几次之后才关注成功.

不过到此,虽然可以关注了,但是还不能算完,因为这个请求里有一个参数:`csrf`是与账号相关的,需要从cookie里面去获取,如果你直接将上面的脚本代码发给别人运行,因为对方的csrf和你的不同,那么就会输出这个内容

```
{"code":-111,"message":"csrf 校验失败","ttl":1}
```

~获取cookie取出csrf这些内容就留到下一节吧~ 记错了,gm_cookie是beta版本的功能,并未加入stable,暂时搁浅





























# 参考

[最新Tampermonkey 中文文档解析 - 大白熊^_^ - 博客园 (cnblogs.com)](https://www.cnblogs.com/dabaixiong/p/14279678.html)

 [油猴脚本开发指南]第一个脚本-HelloWorld https://bbs.tampermonkey.net.cn/thread-88-1-1.html
 [油猴脚本开发指南]脚本自动化之模拟点击和表单填写 https://bbs.tampermonkey.net.cn/thread-91-1-1.html
 [油猴脚本开发指南]grant介绍,none与unsafeWindow https://bbs.tampermonkey.net.cn/thread-160-1-1.html
 [油猴脚本开发指南]h5视频倍速,时间加速和run-at https://bbs.tampermonkey.net.cn/thread-176-1-1.html
 [油猴脚本开发指南]脚本ajax的跨域请求 https://bbs.tampermonkey.net.cn/thread-136-1-1.html
 [油猴脚本开发指南]脚本往页面上添加新元素 https://bbs.tampermonkey.net.cn/thread-237-1-1.html
 [油猴脚本开发指南]外部资源引用 https://bbs.tampermonkey.net.cn/thread-249-1-1.html
 [油猴脚本开发指南]右键菜单与GM_get/setValue函数 https://bbs.tampermonkey.net.cn/thread-271-1-1.html
 [油猴脚本开发指南]特别篇Jquery引用 https://bbs.tampermonkey.net.cn/thread-275-1-1.html
 油猴脚本开发指南]使用GM_addStyle去除网页广告 https://bbs.tampermonkey.net.cn/thread-274-1-1.html
 [油猴脚本开发指南]油猴hook - 实现b站评论小尾巴 https://bbs.tampermonkey.net.cn/thread-429-1-1.html
 油猴脚本开发指南]简易this教程 https://bbs.tampermonkey.net.cn/thread-549-1-1.html
 [油猴脚本开发指南]简易感受this的例子 https://bbs.tampermonkey.net.cn/thread-550-1-1.html
 [油猴脚本开发指南]去除网页广告以及去除元素 https://bbs.tampermonkey.net.cn/thread-688-1-1.html
 [油猴脚本开发指南]箭头函数的特性 https://bbs.tampermonkey.net.cn/thread-720-1-1.html
 [油猴脚本开发指南]原型与原型链 https://bbs.tampermonkey.net.cn/thread-744-1-1.html
 [油猴脚本开发指南]XHR劫持代码原理解释 https://bbs.tampermonkey.net.cn/thread-752-1-1.html
 [油猴脚本开发指南]对象的数据劫持代码 https://bbs.tampermonkey.net.cn/thread-753-1-1.html
 [油猴脚本开发指南]Proxy的使用 https://bbs.tampermonkey.net.cn/thread-765-1-1.html
 [油猴脚本开发指南]Reflect的使用 https://bbs.tampermonkey.net.cn/thread-803-1-1.html
 [油猴脚本开发指南]基本油猴编程的一些常见误区 https://bbs.tampermonkey.net.cn/thread-835-1-1.html
 [油猴脚本开发指南]XHR的返回内容劫持 https://bbs.tampermonkey.net.cn/thread-839-1-1.html
 [油猴脚本开发指南]实战抖音短视频无水印下载 https://bbs.tampermonkey.net.cn/thread-873-1-1.html
 [油猴脚本开发指南]XHR实战百度自定义分享码 https://bbs.tampermonkey.net.cn/thread-877-1-1.html
 [油猴脚本开发指南]Promise基础解释 https://bbs.tampermonkey.net.cn/thread-878-1-1.html
 [油猴脚本开发指南]Promise常用函数与语法糖 https://bbs.tampermonkey.net.cn/thread-881-1-1.html
 [油猴脚本开发指南]包装异步代码为同步代码 https://bbs.tampermonkey.net.cn/thread-883-1-1.html
 [油猴脚本开发指南]Promise执行顺序问题 https://bbs.tampermonkey.net.cn/thread-894-1-1.html
 [油猴脚本开发指南]理解fetch劫持 https://bbs.tampermonkey.net.cn/thread-896-1-1.html
 [油猴脚本开发指南]实战fetch劫持知乎去广告 https://bbs.tampermonkey.net.cn/thread-912-1-1.html
 [油猴脚本开发指南]实战fetch劫持快手无水印视频 https://bbs.tampermonkey.net.cn/thread-927-1-1.html
 [油猴脚本开发指南]addEventListener劫持 https://bbs.tampermonkey.net.cn/thread-967-1-1.html
 [油猴脚本开发指南]script标签初始化对象劫持 https://bbs.tampermonkey.net.cn/thread-979-1-1.html
 [油猴脚本开发指南]MutationObserver的使用 https://bbs.tampermonkey.net.cn/thread-988-1-1.html
 [油猴脚本开发指南]Mutation Event性能影响简易测试 https://bbs.tampermonkey.net.cn/thread-1006-1-1.html
 [油猴脚本开发指南]MutationObserver简单详解 https://bbs.tampermonkey.net.cn/thread-1007-1-1.html
 [油猴脚本开发指南]MutationObserver简易例子 https://bbs.tampermonkey.net.cn/thread-1008-1-1.html
 [油猴脚本开发指南]MutationObserver实战 https://bbs.tampermonkey.net.cn/thread-1017-1-1.html
 [油猴脚本开发指南]Fetch劫持的第二种方式 https://bbs.tampermonkey.net.cn/thread-1020-1-1.html
 [油猴脚本开发指南]油猴脚本调用Vue https://bbs.tampermonkey.net.cn/thread-1030-1-1.html
 [油猴脚本开发指南]修改Vue3代码兼容油猴 https://bbs.tampermonkey.net.cn/thread-1035-1-1.html
 [油猴脚本开发指南]油猴脚本调用element plus https://bbs.tampermonkey.net.cn/thread-1038-1-1.html
 [油猴脚本开发指南]魔改Element plus https://bbs.tampermonkey.net.cn/thread-1039-1-1.html
 [油猴脚本开发指南]延迟查询元素代码解读 https://bbs.tampermonkey.net.cn/thread-1058-1-1.html
 [油猴脚本开发指南]破解鼠标移出限制实战 https://bbs.tampermonkey.net.cn/thread-1060-1-1.html
 [油猴脚本开发指南]Proxy与defineProperty性能分析 https://bbs.tampermonkey.net.cn/thread-1062-1-1.html
 [油猴脚本开发指南]监控对象初始化属性分析 https://bbs.tampermonkey.net.cn/thread-1063-1-1.html
 [油猴脚本开发指南]CSS基础之元素基础 https://bbs.tampermonkey.net.cn/thread-1067-1-1.html
 [油猴脚本开发指南]CSS基础之字体控制 https://bbs.tampermonkey.net.cn/thread-1068-1-1.html
 [油猴脚本开发指南]CSS基础之元素定位 https://bbs.tampermonkey.net.cn/thread-1072-1-1.html
 [油猴脚本开发指南]CSS基础之弹性布局 https://bbs.tampermonkey.net.cn/thread-1074-1-1.html
 [油猴脚本开发指南]新阶段开篇前文 https://bbs.tampermonkey.net.cn/thread-1075-1-1.html
 [油猴脚本开发指南]VUE入门概念 https://bbs.tampermonkey.net.cn/thread-1076-1-1.html
 [油猴脚本开发指南]VUE数据绑定的响应原理 https://bbs.tampermonkey.net.cn/thread-1077-1-1.html
 [油猴脚本开发指南]VUE点击按钮 https://bbs.tampermonkey.net.cn/thread-1081-1-1.html
 [油猴脚本开发指南]响应式编辑框 https://bbs.tampermonkey.net.cn/thread-1083-1-1.html
 [油猴脚本开发指南]魔改toastr https://bbs.tampermonkey.net.cn/thread-1084-1-1.html
 [油猴脚本开发指南]toastr引用 https://bbs.tampermonkey.net.cn/thread-1085-1-1.html
 [油猴脚本开发指南]循环绘制 https://bbs.tampermonkey.net.cn/thread-1087-1-1.html
 [油猴脚本开发指南]循环Key的作用 https://bbs.tampermonkey.net.cn/thread-1088-1-1.html
 [油猴脚本开发指南-难度超标，暂时移除]简明diff(一) https://bbs.tampermonkey.net.cn/thread-1094-1-1.html
 [油猴脚本开发指南-难度超标，暂时移除]简明diff(二) https://bbs.tampermonkey.net.cn/thread-1095-1-1.html
 [油猴脚本开发指南-难度超标，暂时移除]简明diff(三) https://bbs.tampermonkey.net.cn/thread-1101-1-1.html
 [油猴脚本开发指南-难度超标，暂时移除]简明diff(四) https://bbs.tampermonkey.net.cn/thread-1105-1-1.html
 [油猴脚本开发指南]条件判断 https://bbs.tampermonkey.net.cn/thread-1116-1-1.html
 [油猴脚本开发指南]v-show https://bbs.tampermonkey.net.cn/thread-1117-1-1.html
 [油猴脚本开发指南]NPM发布魔改包 https://bbs.tampermonkey.net.cn/thread-1123-1-1.html
 [油猴脚本开发指南]GM存储函数 https://bbs.tampermonkey.net.cn/thread-1133-1-1.html
 [油猴脚本开发指南]vue组件 https://bbs.tampermonkey.net.cn/thread-1136-1-1.html
 [油猴脚本开发指南]with解决require引入问题 https://bbs.tampermonkey.net.cn/thread-1146-1-1.html
 [油猴脚本开发指南]filesaver解决前端下载 https://bbs.tampermonkey.net.cn/thread-1147-1-1.html
 [油猴脚本开发指南]JSZIP库压缩解压文件 https://bbs.tampermonkey.net.cn/thread-1150-1-1.html
 [油猴脚本开发指南]JSZIP库实战 https://bbs.tampermonkey.net.cn/thread-1198-1-1.html
 [油猴脚本开发指南]XHR劫持的第二种格式 https://bbs.tampermonkey.net.cn/thread-1201-1-1.html
 [油猴脚本开发指南]SweetAlert2的漂亮对话框 https://bbs.tampermonkey.net.cn/thread-1203-1-1.html
 [油猴脚本开发指南]元素规则校验和检测的触发 https://bbs.tampermonkey.net.cn/thread-1250-1-1.html
 [油猴脚本开发指南]SweetAlert2进阶 https://bbs.tampermonkey.net.cn/thread-1303-1-1.html
 [油猴脚本开发指南]基础的网页调试(一) https://bbs.tampermonkey.net.cn/thread-1383-1-1.html
 [油猴脚本开发指南]基础的脚本调试(二) https://bbs.tampermonkey.net.cn/thread-1386-1-1.html
 [油猴脚本开发指南]基础的网络分析(三) https://bbs.tampermonkey.net.cn/thread-1389-1-1.html
 [油猴脚本开发指南]实战React数据提取抖音视频 https://bbs.tampermonkey.net.cn/thread-1405-1-1.html
 [油猴脚本开发指南]Vue初探__vue__ https://bbs.tampermonkey.net.cn/thread-1425-1-1.html
 [油猴脚本开发指南]通过__vue__获取数据 https://bbs.tampermonkey.net.cn/thread-1438-1-1.html
 [油猴脚本开发指南]实战秒杀快手视频提取 https://bbs.tampermonkey.net.cn/thread-1441-1-1.html
 [油猴脚本开发指南]应用 & 组件实例 https://bbs.tampermonkey.net.cn/thread-1491-1-1.html
 [油猴脚本开发指南]模板语法 https://bbs.tampermonkey.net.cn/thread-1499-1-1.html
 [油猴脚本开发指南]基本油猴编程的一些常见误区(二) https://bbs.tampermonkey.net.cn/thread-1537-1-1.html
 [油猴脚本开发指南]本地文件访问权限与外部开发 https://bbs.tampermonkey.net.cn/thread-1550-1-1.html
 [油猴脚本开发指南]完善抖音脚本键盘事件 https://bbs.tampermonkey.net.cn/thread-1709-1-1.html
 [油猴脚本开发指南]querySelector与css选择器入门 https://bbs.tampermonkey.net.cn/thread-1821-1-1.html
 [油猴脚本开发指南]Layui库引入扩展模块路径解决方法 https://bbs.tampermonkey.net.cn/thread-1910-1-1.html

-----------------------------------------------------------------------------------------

以下为文章的视频版教程 

  火狐浏览器如何安装油猴脚本 https://www.bilibili.com/video/BV1fX4y1N7gQ/
 [零基础学习油猴脚本开发]第一个脚本-HelloWorld https://www.bilibili.com/video/BV1gT4y1N7zy/
 [零基础学习油猴脚本开发]第二节   脚本自动化之模拟点击和表单填写 https://www.bilibili.com/video/BV16y4y127Hw/
 [零基础学习油猴脚本开发]第三节grant介绍,none与unsafeWindow https://www.bilibili.com/video/BV1Xp4y1s7q4/
 [零基础学习油猴脚本开发]第四节沙盒机制的前世今生 https://www.bilibili.com/video/BV1JA411W7y9/
 [零基础学习油猴脚本开发]第五节h5视频倍速,时间加速和run-at https://www.bilibili.com/video/BV1by4y1H7X3/
 [零基础学习油猴脚本开发]第六节脚本ajax的跨域请求 https://www.bilibili.com/video/BV1qK4y1W7po/
 [零基础学习油猴脚本开发]第七节脚本往页面上添加新元素 https://www.bilibili.com/video/BV1xy4y1n7yM/
 [零基础学习油猴脚本开发]第八节require外部资源引用 https://www.bilibili.com/video/BV1rh411C7d5/
 [零基础学习油猴脚本开发]第8.5节Jquery的引用 https://www.bilibili.com/video/BV1mz4y1U7pE/
 [零基础学习油猴脚本开发]第九节右键菜单与GM_get/setValue函数 https://www.bilibili.com/video/BV1TK4y1Q7fR/
 [零基础学习油猴脚本开发]第十节GM_addStyle去除网页广告 https://www.bilibili.com/video/BV1aK4y1Q7jv/
 [零基础油猴开发]第十一节百度首页去广告小练习 https://www.bilibili.com/video/BV1t64y1b7uc
 [零基础油猴开发]第十二节简单的this介绍 https://www.bilibili.com/video/BV19v411H7Fq
 [零基础油猴开发]第十三节this的简单例子 https://www.bilibili.com/video/BV19v411H7Fq
 [零基础油猴开发]第十四节箭头函数以及箭头函数的this https://www.bilibili.com/video/BV1hy4y1T7Ur







编写油猴脚本时想要调用网页上本身定义的 `saveData` 函数

```js
// ==UserScript==
// @name         Your Script Name
// @namespace    http://your.namespace.com
// @version      1.0
// @description  Your description
// @author       You
// @match        http://example.com/*
// @grant        unsafeWindow
// ==/UserScript==



// 在油猴脚本中手动触发页面上的按钮点击事件
$(document).ready(function() {
  $("#bc").click(function() {
    unsafeWindow.saveData(this, '0');
  });

  $("#tj").click(function() {
    unsafeWindow.saveData(this, '1');
  });
});


// 自动触发
$("#bc").click();
```

注意:  油猴脚本中都是使用自动触发





```
  $("#bc").click();
if(status == "1" && !confirm("您是否确认提交当前评价,提交后不能修改！")) {
    // 自动点击确定按钮
    setTimeout(function() {
       $('.ui-dialog-buttonset button:first').trigger('click');
    }, 10000); // 需要设置一个延迟，以确保弹出框已经加载完成
}

```





```
// ==UserScript==
// @name         自动点击确认按钮
// @include      *在这里输入你想要执行脚本的页面URL*
// @require      https://code.jquery.com/jquery-3.6.0.min.js
// ==/UserScript==

// 使用 jQuery 的 ready 函数，确保页面加载完成后执行
$(document).ready(function() {
    // 保存原始的 confirm 函数，以便后续使用
    var originalConfirm = window.confirm;

    // 重写 confirm 函数
    window.confirm = function(message) {
        // 如果弹窗消息是 "您是否确认提交当前评价,提交后不能修改！"，则自动点击确定按钮
        if (message === "您是否确认提交当前评价,提交后不能修改！") {
            // 模拟用户点击确定按钮
            return true;
        } else {
            // 对于其他弹窗消息，保持原始的 confirm 行为
            return originalConfirm(message);
        }
    };
});

```





# 弹窗自动确认

在油猴脚本中，我们不能直接覆盖页面的 confirm 函数，因为油猴脚本运行在一个隔离的环境中，无法直接访问或修改页面的全局对象。

```js
// ==UserScript==
// @name     Override Confirm
// @match    http://your-website.com/*
// @require  http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js
// @grant    none
// ==/UserScript==

var script = document.createElement('script');
script.textContent = 'window.confirm = function() { return true; };';
$('head').append(script);
```





## 外部资源引用

需求 : 引入外部资源,例如jQuery,vue,和自己写的一些css样式,js脚本等.最终写一个脚本给论坛增加一个黑夜模式(背景全是黑的)

### js资源的引用

#### 方法1使用@require加载

```js
// @require      https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js
```

js代码可能会与前端冲突, 不推荐使用

#### 方法2使用脚本加载

往网页页面中加入script标签去加载js文件.需要注意的是,head标签,body标签等不同的位置中插入,js加载的时间是不同的,不过一般onload之后再执行脚本一般没问题.(注意脚本的 `run-at`属性,最好是 `start`,总之就是js加载顺序和脚本执行顺序,别js还没加载完你脚本就开始用js了)

```js
let script = document.createElement('script');
script.setAttribute('type', 'text/javascript');
script.src = "https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js";
document.documentElement.appendChild(script);
```

### css资源的引用

#### 方法1使用油猴来加载

```js
// @resource css https://blog.icodef.com/wp-content/themes/Kratos-3.0.7/assets/css/kratos.min.css?ver=3.2.4

console.log(GM_getResourceURL("css"),GM_getResourceText("css"));//url是一个base64的url
GM_addStyle(GM_getResourceText("css"));
```

#### 方法2使用脚本加载

```js
let script = document.createElement('link');
script.setAttribute('rel', 'stylesheet');
script.setAttribute('type', 'text/css');
script.href = "https://blog.icodef.com/wp-content/themes/Kratos-3.0.7/assets/css/kratos.min.css?ver=3.2.4";
document.documentElement.appendChild(script);
```

### 加密算法引入

```js
// ==UserScript==
// @name         使用CryptoJS和jQuery的油猴脚本示例
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  在油猴脚本中使用CryptoJS和jQuery
// @match        https://www.example.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */
    /* global CryptoJS */
    
    
    // 手动添加 CryptoJS 脚本标签
    var cryptoJSScript = document.createElement('script');
    cryptoJSScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js';
    document.getElementsByTagName('head')[0].appendChild(cryptoJSScript);

    // 手动添加 jQuery 脚本标签
    var jqueryScript = document.createElement('script');
    jqueryScript.src = 'https://code.jquery.com/jquery-3.6.0.min.js';
    document.getElementsByTagName('head')[0].appendChild(jqueryScript);

    // 等待 CryptoJS 和 jQuery 加载完毕后执行代码
    var scriptsLoaded = 0;

    cryptoJSScript.onload = function() {
        console.log('CryptoJS 加载完成');
        scriptsLoaded++;
        executeIfReady();
    };

    jqueryScript.onload = function() {
        console.log('jQuery 加载完成');
        scriptsLoaded++;
        executeIfReady();
    };
    
    function executeIfReady() {
        if (scriptsLoaded === 2) {
            // 使用 jQuery 进行操作
            $(document).ready(function() {
                // 使用 CryptoJS 加密字符串
                var encryptedString = CryptoJS.MD5('yourStringToBeEncrypted').toString();
                console.log('加密后：' + encryptedString);
            });
        }
    }

})();
```

例子

```js
// @grant        unsafeWindow
// @grant        GM_addStyle
// @grant        GM_xmlhttpRequest

(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */

 // 添加 Bootstrap 5 的 CSS 文件
    var bootstrapCss = document.createElement('link');
    bootstrapCss.rel = 'stylesheet';
    bootstrapCss.href = 'https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css';
    document.head.appendChild(bootstrapCss);

    // 添加 Bootstrap Icons 的 CSS 文件
    var bootstrapIconCss = document.createElement('link');
    bootstrapIconCss.rel = 'stylesheet';
    bootstrapIconCss.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css';
    document.head.appendChild(bootstrapIconCss);
}
```

例子

```js
// ==UserScript==
// @name         登录
// @namespace    https://github.com/Auroraol
// @version      0.1
// @description  长春大学教务系统登录
// @author       lfj
// @match        https://cdjwc.webvpn.ccu.edu.cn/jsxsd/
// @icon
// @grant        unsafeWindow
// @require      https://code.jquery.com/jquery-2.1.4.min.js
// ==/UserScript==


(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */
    /* global CryptoJS */
    var user="032141226";
    var pwd="-+66..[]l";
   // 引入 CryptoJS 的代码
   var cryptoJSScript = document.createElement('script');
   cryptoJSScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js';
   document.getElementsByTagName('head')[0].appendChild(cryptoJSScript);

    // 在 CryptoJS 加载完毕后执行以下代码
    cryptoJSScript.onload = function() {
        // 这里写你的具体逻辑
         var encodedUser = CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(user));
         var encodedPwd = CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(pwd));
         console.log(encodedUser)
         console.log(encodedPwd)
}; 
})();
```

![image-20231214113536341](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/image-20231214113536341.png)











# todo

```js
// ==UserScript==
// @name         学生评价
// @namespace    https://github.com/Auroraol
// @version      0.1
// @description  try to take over the world!
// @author       lfj
// @match        https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_find.do*
// @match        https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_list.do*
// @grant        none
// @require https://code.jquery.com/jquery-2.1.4.min.js
// ==/UserScript==
(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */
    /* eslint no-eval: "off" */

    if (window.location.href.startsWith("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_find.do")) {
        // 在页面1执行逻辑
        processPage1();
    } else if (window.location.href.startsWith("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_list.do")) {
        // 在页面2执行逻辑
        processPage2();
    }


    var index = 0;
    var links = $("a[title='点击进入评价']").map(function() {
        return $(this).prop('href');
    }).get();
    function processNextLink(index) {
        if (links.length > 0 && index < links.length) {
            var nextLink = links[index];
            //console.log(nextLink);
             window.location.href = nextLink;
        }
    }

    function processPage1() {
        // TODO: 处理页面1的逻辑
        console.log("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_find.do");
        processNextLink(index);
    }

    function processPage2() {
        // TODO: 处理页面2的逻辑
        console.log(" https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_list.do");
        //var allEvaluated = true;// 假设所有行都已评价
        // 遍历表格的每一行
        $('#dataList tr').each(function() {
            var tdText = $(this).find('td').eq(6).text(); // 获取第7列的文本
            if (tdText === '否') {
                //var evaluateLink = $(this).find('a:contains("评价")').attr('href');
                 // 获取评价链接的JavaScript代码
                var jsCode = $(this).find('a:contains("评价")').attr('href');
                // console.log(jsCode);
                // 执行JavaScript代码, 链接到填写评价表单
                eval(jsCode.substring(11)); // 去掉前面的"javascript:"
          
                // 填写评价
              //  window.location.href = evaluateLink;


                //allEvaluated = false;
                //return false;
            }
        });


        // 如果所有行都已评价，点击返回按钮
        if ($('#dataList tr td:contains("否")').length === 0) {
            index = index + 1;
            $('#btnShenshen').click();
        }
    }

})();
```





```
function autoEvaluate() {
        var rows = $('#dataList tr');  // 获取所有行
        var num = 0;  // 当前处理的行的索引
        var popupWindow = null;  // 弹出窗口

        function processRow() {
            if (num >= rows.length) {
                // 如果所有行都已处理，点击返回按钮
                if ($('#dataList tr td:contains("否")').length === 0) {
                    $('#btnShenshen').click();
                }
                index++;
                return;
            }

            var row = $(rows[num]);  // 获取当前行
            var tdText = row.find('td').eq(6).text();  // 获取第7列的文本
            if (tdText === '否') {
                // 如果有未评价的行，获取评价链接
                var jsCode = row.find('a:contains("评价")').attr('href');
                // 打开弹出窗口
                popupWindow = window.open(eval(jsCode.substring(11)));  // 去掉前面的"javascript:"
                if (popupWindow === null) {
                    console.error('Failed to open popup window');
                    return;
                }
            }

            // 检查弹出窗口是否关闭
            var checkPopupClosed = setInterval(function() {
                if (popupWindow && popupWindow.closed) {
                    clearInterval(checkPopupClosed);
                    num++;  // 增加索引
                    processRow();  // 处理下一行
                }
            }, 1000);
        }

        // 开始处理第一行
        processRow();
    }

```





首次匹配  –> 油猴脚本所以变量会 重新初始化



# ————

# startsWith

```
if (text.startsWith("评教大类：实践环节学生评价")) {
    // 这是实践环节学生评价
    // 在这里执行你的代码
} else if (text.startsWith("评教大类：理论课学生评价")) {
    // 这是理论课学生评价
    // 在这里执行你的代码
}
```

```
    if (window.location.href.startsWith("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_find.do")) {
        processPage1();
    } else if (window.location.href.startsWith("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_list.do")) {
        processPage2();
    } else if (window.location.href.startsWith("https://cdjwc.webvpn.ccu.edu.cn/jsxsd/xspj/xspj_edit.do")){
       // processPage3();
       }
```

# window.location

```
window.location.reload(); //刷新当前页面 
window.location.href = "url"  //跳转
```





# 页面切换, 传递数据localStorage

```
 var indexNext = localStorage.getItem('indexNext');
 indexNext++;
 localStorage.setItem('indexNext', indexNext.toString());
```











```

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
```





```
// ==UserScript==
// @name         窗口
// @namespace    https:*
// @version      0.1
// @description  try to take over the world!
// @author       lfj
// @match        *://*/*
// @require      https://code.jquery.com/jquery-3.1.0.js
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        GM_addStyle
// ==/UserScript==

(function() {
    'use strict';
    /* globals jQuery, $, waitForKeyElements */

/*
      if (self == top) {
              GM_addStyle(`#zizhuPopupMain { position: fixed; z-index: 999; right: 0; bottom: 20px; background: #fff; }
#zizhuPopupMain-hd { font-size: 14px; line-height: 30px; overflow: hidden; box-sizing: border-box; height: 30px; padding: 0 10px; cursor: pointer; white-space: nowrap; text-overflow: ellipsis; color: #fff; background: #4d90fe; }
#zizhuPopupMain-hd svg { display: none; margin-top: 2px; }
#zizhuPopupMain-bd { box-sizing: border-box; height: 60px; padding: 10px; border: 1px solid #ccc; }
#zizhuPopupMainInput { display: inline-block; box-sizing: border-box; width: 210px; height: 40px; padding: 0 10px; border: 1px solid #ccc; outline: none; }
#zizhuPopupMainBtn { font-size: 13px; line-height: 39px; display: inline-block; width: 60px; height: 40px; margin-left: -5px; text-align: center; text-decoration: none; color: #fff; background: #4d90fe; }
.zizhuPopupMainSmallHead { width: 32px; }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd { padding: 0 4px; box-shadow: 1px 2px 3px rgba(12, 12, 12, .3); }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd span { display: none; }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd svg { display: block; }
`)
    // 添加内容
    var smallCnt = `<div id="zizhuPopupMain">
		<div id="zizhuPopupMain-hd">
			<span>蜘蛛磁力搜索<small>(点击可缩小)</small></span>
			<!--<svg t="1542846569380" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1925" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><defs><style type="text/css"></style></defs><path d="M215.51289 370.94645c2.566452 1.534959 5.383614 2.25332 8.16803 2.25332 5.476735 0 10.796904-2.800789 13.802354-7.839549 45.552475-76.69373 129.193431-124.343983 218.281445-124.343983 8.856715 0 16.023952-7.166213 16.023952-16.023952s-7.167237-16.023952-16.023952-16.023952c-100.338243 0-194.541765 53.658084-245.838058 140.022057C205.404672 356.596627 207.907679 366.440833 215.51289 370.94645z" p-id="1926" fill="#ffffff"></path><path d="M196.751594 417.501766c-8.607028-1.987261-17.229406 3.332908-19.24839 11.955286-4.78805 20.451798-7.495718 33.127492-7.495718 55.879682 0 8.856715 7.182586 16.023952 16.023952 16.023952 8.857738 0 16.024975-7.167237 16.024975-16.023952 0-19.309788 2.159176-29.387307 6.650467-48.588625C210.724841 428.125731 205.372949 419.519726 196.751594 417.501766z" p-id="1927" fill="#ffffff"></path><path d="M947.204451 876.167047 784.053628 713.013153c-0.441045-0.442068-0.893346-0.86367-1.351787-1.272993 41.450041-62.197574 65.652256-136.821155 65.652256-217.013569 0-216.480426-176.10895-392.589376-392.588353-392.589376-216.4661 0-392.589376 176.10895-392.589376 392.589376 0 216.47224 176.123276 392.58119 392.589376 392.58119 78.758762 0 152.117536-23.378453 213.647915-63.470567l-46.695508-46.694485c-49.01125 29.074176-105.971543 46.069245-166.952406 46.069245-181.131337 0-328.493569-147.343813-328.493569-328.48436 0-181.131337 147.361209-328.493569 328.493569-328.493569 181.130314 0 328.493569 147.362232 328.493569 328.493569 0 85.36932-33.002648 162.956396-86.567611 221.433228l36.58422 36.585243c1.251503 1.983167 2.732228 3.860934 4.459568 5.588275l163.15287 163.151847c6.259564 6.259564 14.459317 9.389858 22.659069 9.389858s16.415878-3.130294 22.659069-9.389858C959.724603 908.980383 959.724603 888.684128 947.204451 876.167047z" p-id="1928" fill="#ffffff"></path></svg>-->
		</div>
		<div id="zizhuPopupMain-bd">
			<input type="text" name="" placeholder="电影,小说,游戏,想找的全都有" id="zizhuPopupMainInput" />
			<a href="javascript:void(0);" id="zizhuPopupMainBtn">搜索</a>
		</div>`
    // 添加到 body
    var odom = document.createElement("div");
    odom.id = "zizhuPopupMain";
    odom.innerHTML = smallCnt;
    document.body.appendChild(odom);
    // 点击 hd 事件
    $('#zizhuPopupMain-hd').click(function(){
		//$('#zizhuPopupMain').toggleClass('zizhuPopupMainSmallHead')
		$('#zizhuPopupMain-bd').slideToggle()
	})
    //点击搜索事件
    $('#zizhuPopupMainBtn').click(function(){
		let val = $('#zizhuPopupMainInput').val();
		if(val != '' && val != null && val != undefined){
			console.log(val)
			$(this).attr({
				//href:'http://www.zhizhud.com/so/'+val+'-first-asc-1',
				href:'https://cilibird.com/s/'+val+'/time-1.html',
				target: '_blank'
			})
		}
	})
    // 回车事件
    $('#zizhuPopupMainInput').keydown(function(e){
		if(e.keyCode == 13) {
			let val = $('#zizhuPopupMainInput').val();
			if(val != '' && val != null && val != undefined){
				//window.open('http://www.zhizhud.com/so/'+val+'-first-asc-1')
				window.open('https://cilibird.com/s/'+val+'/time-1.html')
			}
		}
	})
	}

})();
```



```
// ==UserScript==
// @name         蜘蛛磁力搜索弹窗版
// @namespace    https://zizhucili.com
// @version      0.7
// @description  搜索想看的视频,书籍,软件的磁力链接,方便高效,想搜什么搜什么
// @author       Fructose
// @match        *://*/*
// @grant        GM_addStyle
// @require      https://code.jquery.com/jquery-3.1.0.js
// @license      MIT
// @icon         https://cdn-img.easyicon.net/png/376/37643.gif
// ==/UserScript==
 
(function() {
    'use strict';
 
    if (self == top) {
              GM_addStyle(`#zizhuPopupMain { position: fixed; z-index: 999; right: 0; bottom: 20px; background: #fff; }
#zizhuPopupMain-hd { font-size: 14px; line-height: 30px; overflow: hidden; box-sizing: border-box; height: 30px; padding: 0 10px; cursor: pointer; white-space: nowrap; text-overflow: ellipsis; color: #fff; background: #4d90fe; }
#zizhuPopupMain-hd svg { display: none; margin-top: 2px; }
#zizhuPopupMain-bd { box-sizing: border-box; height: 60px; padding: 10px; border: 1px solid #ccc; }
#zizhuPopupMainInput { display: inline-block; box-sizing: border-box; width: 210px; height: 40px; padding: 0 10px; border: 1px solid #ccc; outline: none; }
#zizhuPopupMainBtn { font-size: 13px; line-height: 39px; display: inline-block; width: 60px; height: 40px; margin-left: -5px; text-align: center; text-decoration: none; color: #fff; background: #4d90fe; }
.zizhuPopupMainSmallHead { width: 32px; }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd { padding: 0 4px; box-shadow: 1px 2px 3px rgba(12, 12, 12, .3); }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd span { display: none; }
.zizhuPopupMainSmallHead  #zizhuPopupMain-hd svg { display: block; }
`)
    // 添加内容
    var smallCnt = `<div id="zizhuPopupMain">
		<div id="zizhuPopupMain-hd">
			<span>蜘蛛磁力搜索<small>(点击可缩小)</small></span>
			<svg t="1542846569380" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1925" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24"><defs><style type="text/css"></style></defs><path d="M215.51289 370.94645c2.566452 1.534959 5.383614 2.25332 8.16803 2.25332 5.476735 0 10.796904-2.800789 13.802354-7.839549 45.552475-76.69373 129.193431-124.343983 218.281445-124.343983 8.856715 0 16.023952-7.166213 16.023952-16.023952s-7.167237-16.023952-16.023952-16.023952c-100.338243 0-194.541765 53.658084-245.838058 140.022057C205.404672 356.596627 207.907679 366.440833 215.51289 370.94645z" p-id="1926" fill="#ffffff"></path><path d="M196.751594 417.501766c-8.607028-1.987261-17.229406 3.332908-19.24839 11.955286-4.78805 20.451798-7.495718 33.127492-7.495718 55.879682 0 8.856715 7.182586 16.023952 16.023952 16.023952 8.857738 0 16.024975-7.167237 16.024975-16.023952 0-19.309788 2.159176-29.387307 6.650467-48.588625C210.724841 428.125731 205.372949 419.519726 196.751594 417.501766z" p-id="1927" fill="#ffffff"></path><path d="M947.204451 876.167047 784.053628 713.013153c-0.441045-0.442068-0.893346-0.86367-1.351787-1.272993 41.450041-62.197574 65.652256-136.821155 65.652256-217.013569 0-216.480426-176.10895-392.589376-392.588353-392.589376-216.4661 0-392.589376 176.10895-392.589376 392.589376 0 216.47224 176.123276 392.58119 392.589376 392.58119 78.758762 0 152.117536-23.378453 213.647915-63.470567l-46.695508-46.694485c-49.01125 29.074176-105.971543 46.069245-166.952406 46.069245-181.131337 0-328.493569-147.343813-328.493569-328.48436 0-181.131337 147.361209-328.493569 328.493569-328.493569 181.130314 0 328.493569 147.362232 328.493569 328.493569 0 85.36932-33.002648 162.956396-86.567611 221.433228l36.58422 36.585243c1.251503 1.983167 2.732228 3.860934 4.459568 5.588275l163.15287 163.151847c6.259564 6.259564 14.459317 9.389858 22.659069 9.389858s16.415878-3.130294 22.659069-9.389858C959.724603 908.980383 959.724603 888.684128 947.204451 876.167047z" p-id="1928" fill="#ffffff"></path></svg>
		</div>
		<div id="zizhuPopupMain-bd">
			<input type="text" name="" placeholder="电影,小说,游戏,想找的全都有" id="zizhuPopupMainInput" />
			<a href="javascript:void(0);" id="zizhuPopupMainBtn">搜索</a>
		</div>`
    // 添加到 body
    var odom = document.createElement("div");
    odom.id = "zizhuPopupMain";
    odom.innerHTML = smallCnt;
    document.body.appendChild(odom);
    // 点击 hd 事件
    $('#zizhuPopupMain-hd').click(function(){
		$('#zizhuPopupMain').toggleClass('zizhuPopupMainSmallHead')
		$('#zizhuPopupMain-bd').slideToggle()
	})
    //点击搜索事件
    $('#zizhuPopupMainBtn').click(function(){
		let val = $('#zizhuPopupMainInput').val();
		if(val != '' && val != null && val != undefined){
			console.log(val)
			$(this).attr({
				//href:'http://www.zhizhud.com/so/'+val+'-first-asc-1',
				href:'https://cilibird.com/s/'+val+'/time-1.html',
				target: '_blank'
			})
		}
	})
    // 回车事件
    $('#zizhuPopupMainInput').keydown(function(e){
		if(e.keyCode == 13) {
			let val = $('#zizhuPopupMainInput').val();
			if(val != '' && val != null && val != undefined){
				//window.open('http://www.zhizhud.com/so/'+val+'-first-asc-1')
				window.open('https://cilibird.com/s/'+val+'/time-1.html')
			}
		}
	})
	}
})();
```



# 登录表单是如何做到每次打开浏览器, 自动填写的

另一种方式是使用浏览器的本地存储功能，比如localStorage或sessionStorage。当用户输入账号密码时，这些值会被存储在本地存储中，然后在页面加载时检查本地存储中是否存在这些值，并将它们填充到相应的输入框中。

```js
// 当用户输入账号密码时保存到本地存储
$('#email, #pwd').on('input', function() {
  localStorage.setItem('email', $('#email').val());
  localStorage.setItem('password', $('#pwd').val());
});

// 页面加载时检查本地存储中是否有账号密码，并填充到输入框中
$(document).ready(function() {
  $('#email').val(localStorage.getItem('email'));
  $('#pwd').val(localStorage.getItem('password'));
});
```







url跳转  –> 脚本刷新







# 发布

### 发布脚本

**发布脚本的平台主要有两个：**

- [GreasyFork](https://greasyfork.org/)
- [OpenUserJS](https://openuserjs.org/)

**下面以 `GreasyFork`为例:** 首先要有一个GreasyFork的账号，点击[这个链接](https://greasyfork.org/zh-CN/users/sign_in?return_to=%2Fzh-CN)前往注册，如下图所示：

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAY295Y3M=,size_20,color_FFFFFF,t_70,g_se,x_16.png)

 



点击右上角你的名字进入你的主页，点击 `**发布你编写的脚本** `，如下图所示：

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/1be2548d26c448c48292d2cc31852c84.gif) 



在 **`代码 `**位置直接粘贴自己的代码或者本地上传文件 在 **`附加信息 `**位置可以写脚本的介绍等其他信息，支持HTML和Markdown 其他选项可以直接默认，最后点击 **`发布脚本 。`**1

# 常用插件

如果还想下载BILIBILI视频：就安装这个插件（chorme应用商店也能搜到）

[ACG Helper: Bilibili Auxiliary - Microsoft Edge Addons](https://microsoftedge.microsoft.com/addons/detail/acg-helper-bilibili-auxi/fcfebhekhbkhjjimonjmbgmkbclheaoh)



![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/p629233897.webp)

直接下载就行了



————————————————

v1.0 原文

碰到喜欢的B站知识类视频，怎么轻松提取人声文案/字幕（中英文通用），免得自己拖进度条旁边开个窗口打字做笔记？

此方法用来解决这样的困扰:看视频效率太低了,忍不住分心、拉进度条,暂停打字做笔记好累,收藏的视频在角落里积灰。

谢谢发教程视频的两位up主～



前提1：视频up主不分享文案+还没有人贡献笔记+视频没有外挂cc字幕, 所以不得不用这个办法。

前提2：电脑端操作。

==========导出MP4视频（参考操作视频：BV1ku411n7Dx）================



<iframe allow="fullscreen" allowfullscreen="allowfullscreen" frameborder="0" height="500" scrolling="no" src="https://player.bilibili.com/player.html?bvid=BV1ku411n7Dx&amp;autoplay=0" width="620" style="max-width: 100%;"></iframe>

可能是效果最好最方便的b站视频下载方法！简洁教程高清下载，不拼接、不转码！_哔哩哔哩_bilibili



第一步：微软应用商店下载 bilibili bwp，设置下载路径；

第二步：用bv号在bwp中搜索要下载的视频

第三步：下载视频到前置路径中（建议下载360p画质的就行, 体积小速度快点），发现子文件夹1中有一个MP4格式打不开

第四步：用notepad++进行编辑，删掉前面三个xFF，别删多别删少了

==========提取字幕（参考操作视频：BV1hv4y1g7Wr）================



<iframe allow="fullscreen" allowfullscreen="allowfullscreen" frameborder="0" height="500" scrolling="no" src="https://player.bilibili.com/player.html?bvid=BV1hv4y1g7Wr&amp;autoplay=0" width="620" style="max-width: 100%;"></iframe>

如何快速提取视频中的字幕？简单高效免费的提取视频中字幕的方法_哔哩哔哩_bilibili



第五步：视频可以正常打开了，导入到剪映中，使用智能字幕功能，识别字幕

第六步：点击导出，不勾选导出视频，只导出字幕

第七步：字幕就是笔记，后面根据个人喜好处理吧。如果是英文就用有道翻译一下。

（我喜欢导出字幕之后,在记事本中一边听着视频音频,一边删减字幕内容,加上标点符号,形成自己的笔记。有没有发现, 原来传统记笔记的方式,看视频+暂停打字, 花费双倍的时间,极其低效,难以坚持～)

结束。这一套流程熟练之后很快的。

————————————————————————

如果视频本来就有CC字幕，安装油猴脚本，复制/下载字幕

[Bilibili CC字幕工具 (greasyfork.org)](https://greasyfork.org/en/scripts/378513-bilibili-cc字幕工具)

![img](%E6%B2%B9%E7%8C%B4%E7%AC%94%E8%AE%B0.assets/p627207992.webp)

------------------------------------------------

