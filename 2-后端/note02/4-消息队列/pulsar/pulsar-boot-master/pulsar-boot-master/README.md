## å‰è¨€

### ğŸŠç¼˜ç”±

####  æ¶ˆæ¯é˜Ÿåˆ—ä¸€å‡ºæ‰‹ï¼Œpulsarå°±çŸ¥æœ‰æ²¡æœ‰

![](https://img.javadog.net/blog/pulsar/929ad614405b456d96de4aaae16563ff.png)

##### ğŸ£é—ªäº®ä¸»è§’

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[JavaDogç¨‹åºç‹—](https://mp.weixin.qq.com/s/FjOdxCAPFrJpruhS1YB-MA)

ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«**pulsar**ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼çš„æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…ä¼ é€’å¹³å°ã€‚

æœ¬ç‹—ä»¥èº«å…¥å±€ï¼Œå°†**pulsarçš„ä½¿ç”¨åœºæ™¯ï¼Œç»“åˆå®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼Œè¿›è¡Œå¤§ç™½è¯åˆ†æ**ã€‚

é€šè¿‡ç®€å•ä»£ç demoè¿›è¡Œè®²è§£ï¼Œ**pulsaråœ¨javaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿå¦‚ä½•é€šè¿‡pulsarè¿›è¡Œå¼‚æ­¥è§£è€¦ï¼Ÿ......ç­‰**

![](https://img.javadog.net/blog/pulsar/e855198ab1e44ca4a3402713ce634928.png)

#####  ğŸ˜ˆä½ æƒ³å¬çš„æ•…äº‹ 

ç‹—å“¥æœ€è¿‘åœ¨æ•´ç†å­¦ä¹ ç¬”è®°æ—¶ï¼Œå¶ç„¶åœ¨ç™¾åº¦å‘ç°pulsarç›¸å…³çš„æ•™ç¨‹ç«Ÿç„¶å¤§éƒ¨åˆ†ä»˜è´¹ä¼šå‘˜æ‰èƒ½çœ‹ï¼Œæ·¦ï¼

![](https://img.javadog.net/blog/pulsar/3e8721f50a4f43cd959f323ffb082140.png)

é¦–å…ˆï¼Œæˆ‘ä¸åå¯¹çŸ¥è¯†ä»˜è´¹ï¼Œä½†æ˜¯èŠ±é’±æ‰èƒ½çœ‹æ€»æ„Ÿè§‰å·®é‚£ä¹ˆä¸€ç‚¹æ„æ€ã€‚

äºæ˜¯ä¹ï¼Œç‹—å“¥å°†**æˆ‘å¸æ—¥å¸¸ä½¿ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—pulsarè¿›è¡Œæ€»ç»“æ•´ç†**ï¼Œè®©å¤§å®¶ä¸€æ¬¡æ€§å…è´¹å­¦ä¸ªå¤Ÿï¼Œä¸ä»˜è´¹ä¹Ÿèƒ½å­¦çš„é…£ç•…æ·‹æ¼“

### ğŸå¦‚ä½•è·å–æºç 

å…¬ä¼—å·ï¼šã€JavaDogç¨‹åºç‹—ã€‘

å…³æ³¨å…¬ä¼—å·ï¼Œ**å‘é€  â€œpulsarâ€**ï¼Œæ— ä»»ä½•å¥—è·¯å³å¯è·å¾—ï¼

![](https://img.javadog.net/blog/pulsar/0ee7aee02e0f4de99ee78ab98f80517d.png)

## æ­£æ–‡

### ğŸ¯ä¸»è¦ç›®æ ‡

#### 1.pulsaræ˜¯ä»€ä¹ˆ

#### 2.pulsaræœ‰ä»€ä¹ˆæ ¸å¿ƒç‰¹æ€§

#### 3.pulsarä¸å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—åŒºåˆ«

#### 4.dockerå¦‚ä½•å®‰è£…pulsar

#### 5.dockerå¦‚ä½•å®‰è£…pulsar-manager

#### 6.å®é™…ç”µå•†ä¸šåŠ¡åˆ†æ

#### 7.javaä¸­å¦‚ä½•ä½¿ç”¨pulsarè§£å†³ä¸šåŠ¡é—®é¢˜

### ğŸªç›®æ ‡è®²è§£

#### ä¸€.pulsaræ˜¯ä»€ä¹ˆï¼Ÿ

##### 1.å®˜ç½‘åœ°å€

> [https://pulsar.apache.org/](https://pulsar.apache.org/)

![](https://img.javadog.net/blog/pulsar/2bbb4b2f73e647eaa20665aa46f76c8b.png)

##### 2.pulsarç®€ä»‹

> Apache Pulsar æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ‰©å±•ä¸”çµæ´»çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’å’Œæµå¤„ç†å¹³å°

 ğŸ‘½äººè¯è§£é‡Š

> Pulsar å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå’ŒKafkaã€RocketMQåŠŸèƒ½å·®ä¸å¤šï¼Œå¤šç”¨äºå‰Šå³°è§£è€¦

##### 3.pulsarå‘å±•å†ç¨‹

- Pulsar æœ€åˆç”± Yahoo å¼€å‘ï¼Œå¹¶åœ¨å†…éƒ¨å¤§è§„æ¨¡ä½¿ç”¨ã€‚

- 2016 å¹´ï¼ŒYahoo å°† Pulsar å¼€æºï¼Œå¹¶å°†å…¶æèµ ç»™ Apache è½¯ä»¶åŸºé‡‘ä¼šã€‚

- 2018 å¹´ï¼ŒPulsar æˆä¸ºäº† **Apache è½¯ä»¶åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®**ã€‚

![](https://img.javadog.net/blog/pulsar/34a8189a51c443c8996198237fe552fa.png)

******

#### äºŒ.pulsaræ ¸å¿ƒç‰¹æ€§ï¼Ÿ

##### 1.æ¶ˆæ¯ä¼ é€’

- æ”¯æŒå¤šç§æ¶ˆæ¯è®¢é˜…æ¨¡å¼
	å¦‚ç‹¬å ï¼ˆExclusiveï¼‰ã€ç¾å¤‡ï¼ˆFailoverï¼‰ã€å…±äº«ï¼ˆSharedï¼‰å’Œ Key_Shared è®¢é˜…ã€‚
	
- æ”¯æŒæ¶ˆæ¯çš„å»¶è¿Ÿå‘é€ï¼Œ
	å³æ¶ˆæ¯å¯ä»¥åœ¨å‘å¸ƒåçš„ä¸€æ®µæ—¶é—´å†…è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚

##### 2.å­˜å‚¨ä¸è®¡ç®—åˆ†ç¦»æ¶æ„

- Pulsar é‡‡ç”¨äº†å­˜å‚¨ä¸è®¡ç®—åˆ†ç¦»çš„è®¾è®¡ï¼Œè¿™æ„å‘³ç€æ¶ˆæ¯çš„å¤„ç†é€»è¾‘ï¼ˆBrokerï¼‰ä¸æ•°æ®å­˜å‚¨å¯ä»¥ç‹¬ç«‹æ‰©å±•ã€‚
- è¿™ç§æ¶æ„ä½¿å¾— Pulsar åœ¨æ‰©å±•æ€§å’Œå¯é æ€§æ–¹é¢è¡¨ç°ä¼˜å¼‚ã€‚

##### 3.å¤šç§Ÿæˆ·æ”¯æŒ

- Pulsar æ”¯æŒå¤šç§Ÿæˆ·ç¯å¢ƒï¼Œå…è®¸ä¸åŒçš„åº”ç”¨ç¨‹åºæˆ–å›¢é˜Ÿåœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­è¿è¡Œè€Œäº’ä¸å½±å“ã€‚

##### 4.æŒä¹…åŒ–å­˜å‚¨

- Pulsar æä¾›äº†æŒä¹…åŒ–çš„æ¶ˆæ¯å­˜å‚¨èƒ½åŠ›ï¼Œç¡®ä¿å³ä½¿åœ¨æ•…éšœå‘ç”Ÿæ—¶æ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

##### 5.è½»é‡çº§å‡½æ•°å¼è®¡ç®—

- Pulsar æ”¯æŒåœ¨æ¶ˆæ¯ä¼ é€’ä¹‹ä¸Šæ„å»ºç®€å•çš„å‡½æ•°å¼è®¡ç®—ï¼Œè¿™ä½¿å¾—å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿˜å¯ä»¥ç”¨äºå®ç°æµå¤„ç†åº”ç”¨ã€‚

##### 6.è·¨åœ°åŸŸå¤åˆ¶

- Pulsar å…è®¸è·¨å¤šä¸ªåœ°ç†ä½ç½®çš„æ•°æ®ä¸­å¿ƒè¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’Œç¾éš¾æ¢å¤ã€‚

ğŸ‘½äººè¯è§£é‡Š

> Pulsar å°±åƒæ˜¯ä¸€ä¸ªå¿«é€’ä¸­è½¬ç«™ï¼Œä½†å®ƒä¸ä»…èƒ½é«˜æ•ˆåœ°å¤„ç†å¤§é‡çš„åŒ…è£¹ï¼ˆæ¶ˆæ¯ï¼‰ï¼Œè¿˜èƒ½ç¡®ä¿æ¯ä¸ªåŒ…è£¹éƒ½èƒ½å‡†ç¡®æ— è¯¯åœ°é€è¾¾ç›®çš„åœ°ï¼ˆæ¶ˆè´¹è€…ï¼‰

******

#### ä¸‰.pulsarä¸å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—åŒºåˆ«ï¼Ÿ

|  | Pulsar |ActiveMQ  |RabbitMQ  | RocketMQ | Kafka |
|--|--|--|--|--|--|
|å•æœºååé‡  | åä¸‡çº§ | ä¸‡çº§ | ä¸‡çº§ |åä¸‡çº§  | åä¸‡çº§ |
|å¼€å‘è¯­è¨€  | Java |Java  | Erlang |Java  | Java/Scala |
|ç»´æŠ¤è€…  | Apache |Apache  | Spring |Apache | Apache  |
|ç¤¾åŒºæ´»è·ƒåº¦  | é«˜ | ä½ | é«˜ | é«˜ | é«˜ |
|æ¶ˆè´¹æ¨¡å¼  |ç‹¬å ã€å…±äº«ã€ç¾å¤‡ã€keyå…±äº«  |P2Pã€Pub-Sub  |directã€topicã€Headersã€fanout  | åŸºäºTopicå’ŒMessageTag |åŸºäºTopicçš„Pub-Sub  |
|é¡ºåºæ¶ˆæ¯  |æ”¯æŒ  | ä¸æ”¯æŒ |ä¸æ”¯æŒ | æ”¯æŒ | æ”¯æŒ  |
|ç¨³å®šæ€§  |ä¸€èˆ¬  | å¥½ | å¥½ | ä¸€èˆ¬ | è¾ƒå·® |
|é›†ç¾¤æ”¯æŒ  | é›†ç¾¤æ¨¡å¼ |ä¸»å¤‡æ¨¡å¼  | å¤åˆ¶æ¨¡å¼ |ä¸»å¤‡æ¨¡å¼  | é›†ç¾¤å¯æ‰©å±•æ€§å¼º |

å…³äºæ¶ˆæ¯é˜Ÿåˆ—çš„é€‰å–ï¼Œåœ¨å®é™…æ¡ˆä¾‹ä¸­å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’ŒæŠ€æœ¯èƒŒæ™¯

1. å¤§è§„æ¨¡æ•°æ®æµå¤„ç†
æ¨èä½¿ç”¨ï¼šApache Pulsar æˆ– Apache Kafka
ç†ç”±ï¼š
Pulsarï¼šæ”¯æŒå­˜å‚¨ä¸è®¡ç®—åˆ†ç¦»ï¼Œå¯ä»¥ç‹¬ç«‹æ‰©å±•å­˜å‚¨å’Œå¤„ç†èƒ½åŠ›ï¼Œéå¸¸é€‚åˆå¤§è§„æ¨¡æ•°æ®æµå¤„ç†ã€‚
Kafkaï¼šä»¥å…¶é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿè‘—ç§°ï¼Œé€‚åˆå¤„ç†å¤§é‡å®æ—¶æ•°æ®æµã€‚

2. å¤šç§Ÿæˆ·ç¯å¢ƒ
æ¨èä½¿ç”¨ï¼šApache Pulsar
ç†ç”±ï¼š
Pulsarï¼šæä¾›äº†å¼ºå¤§çš„å¤šç§Ÿæˆ·æ”¯æŒï¼Œå¯ä»¥ä¸ºä¸åŒçš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡åˆ†é…ç‹¬ç«‹çš„å‘½åç©ºé—´å’Œèµ„æºã€‚

3. é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§
æ¨èä½¿ç”¨ï¼šApache Pulsar æˆ– Apache Kafka
ç†ç”±ï¼š
Pulsarï¼šå…·æœ‰å†…ç½®çš„é«˜å¯ç”¨æ€§æ”¯æŒï¼Œæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ”¯æŒæ¶ˆæ¯å¤åˆ¶ã€‚
Kafkaï¼šåŒæ ·å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–å’Œå‰¯æœ¬æœºåˆ¶ã€‚

4. çµæ´»çš„æ¶ˆæ¯è·¯ç”±
æ¨èä½¿ç”¨ï¼šApache RabbitMQ
ç†ç”±ï¼š
RabbitMQï¼šåŸºäº AMQP åè®®ï¼Œæ”¯æŒå¤æ‚çš„è·¯ç”±è§„åˆ™å’Œæ¶ˆæ¯æ¨¡å¼ï¼Œéå¸¸é€‚åˆéœ€è¦çµæ´»æ¶ˆæ¯è·¯ç”±çš„åœºæ™¯ã€‚

5. ç®€å•æ˜“ç”¨æ€§
æ¨èä½¿ç”¨ï¼šApache RabbitMQ æˆ– RocketMQ
ç†ç”±ï¼š
RabbitMQï¼šæä¾›äº†ä¸°å¯Œçš„å®¢æˆ·ç«¯åº“ï¼Œæ˜“äºé›†æˆã€‚
RocketMQï¼šAPI è®¾è®¡ç®€æ´ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ã€‚

******

#### å››.dockerå¦‚ä½•å®‰è£…pulsar

å°ä¼™ä¼´å¦‚æœä¸ä¼šåœ¨windowsä¸Šå®‰è£…dockerï¼Œè¯·æŸ¥çœ‹ç‹—å“¥ä¹‹å‰æ–‡ç« 

[ã€ä»é›¶å¼€å§‹ã€‘Docker Desktopï¼šå¬è¯´ä½ å°å­è¦ç©æˆ‘](https://mp.weixin.qq.com/s/kZXSpU8Cc2yswEglozAvTQ)

> https://mp.weixin.qq.com/s/kZXSpU8Cc2yswEglozAvTQ

##### 1.å®‰è£…pulsar 

> æ‹‰å–pulsar2.9.2ç‰ˆæœ¬é•œåƒ

åœ¨Windows PowerShellï¼Œè¾“å…¥æ‹‰å–pulsaré•œåƒå‘½ä»¤

```
docker pull apachepulsar/pulsar:2.9.2
```

![](https://img.javadog.net/blog/pulsar/1c8d4909fb7f457eb0b35279af5e2da3.png)

##### 2.å¯åŠ¨pulsar 

> å¯åŠ¨pulsar2.9.2å•æœºç‰ˆ

```
docker run -it -p 6650:6650 -p 8080:8080 apachepulsar/pulsar:2.9.2 bin/pulsar standalone
```

![](https://img.javadog.net/blog/pulsar/4ff4ae2075c442a28e8be884bbf1d5f3.png)

##### 3.å…³é—­å¯¹è¯æ¡†

ä½¿ç”¨Ctrl+P+Qç»„åˆé”®ã€‚å½“ä½ åœ¨å®¹å™¨å†…éƒ¨æ—¶ï¼ŒæŒ‰ä¸‹è¿™ä¸ªç»„åˆé”®å¯ä»¥å°†å½“å‰çš„ç»ˆç«¯ä¼šè¯æ–­å¼€ï¼ŒåŒæ—¶ä¿æŒå®¹å™¨ç»§ç»­è¿è¡Œã€‚

```
Ctrl+P+Q
```

![](https://img.javadog.net/blog/pulsar/07613fb1abf04f9b9d2a051055f3008a.png)

******

#### äº”.dockerå¦‚ä½•å®‰è£…pulsar-manager

ä»€ä¹ˆæ˜¯pulsar-managerï¼Ÿ

> **Pulsar Manager æ˜¯ Apache Pulsar çš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·ç•Œé¢å’Œ RESTful API ç”¨äºç®¡ç†å’Œç›‘æ§ Pulsar é›†ç¾¤**ã€‚
> Pulsar Manager å¯ä»¥å¸®åŠ©ç®¡ç†å‘˜æ‰§è¡Œä¸€ç³»åˆ—é›†ç¾¤ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºå’Œåˆ é™¤å‘½åç©ºé—´ã€ç®¡ç† topicã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ç­‰ã€‚

ğŸ‘½äººè¯è§£é‡Š

> pulsar-managerå°±æ˜¯ä¸€ä¸ªpulsarçš„å¯è§†åŒ–å·¥å…·ï¼ŒåŠŸèƒ½å°±åƒNavicatå·®ä¸å¤š

##### 1.å®‰è£…pulsar-manager 

> æ‹‰å–pulsar-manager0.2.0ç‰ˆæœ¬é•œåƒ

åœ¨Windows PowerShellï¼Œè¾“å…¥æ‹‰å–pulsaré•œåƒå‘½ä»¤

```
docker pull apachepulsar/pulsar-manager:v0.2.0
```

![](https://img.javadog.net/blog/pulsar/b7698d0fe07148e9847efee15628d5f3.png)

##### 2.å¯åŠ¨pulsar-manager  

> å¯åŠ¨pulsar-manager v0.2.0

```
docker run -it -p 9527:9527 -p 7750:7750 -e SPRING_CONFIGURATION_FILE=/pulsar-manager/pulsar-manager/application.properties apachepulsar/pulsar-manager:v0.2.0
```

![](https://img.javadog.net/blog/pulsar/3faeaf08edfa41019082c253b02d2794.png)

##### 3.å…³é—­å¯¹è¯æ¡†

ä½¿ç”¨Ctrl+P+Qç»„åˆé”®ã€‚å½“ä½ åœ¨å®¹å™¨å†…éƒ¨æ—¶ï¼ŒæŒ‰ä¸‹è¿™ä¸ªç»„åˆé”®å¯ä»¥å°†å½“å‰çš„ç»ˆç«¯ä¼šè¯æ–­å¼€ï¼ŒåŒæ—¶ä¿æŒå®¹å™¨ç»§ç»­è¿è¡Œã€‚

```
Ctrl+P+Q
```

![](https://img.javadog.net/blog/pulsar/d17b36d9ce734f668e88899611a77aa3.png)

##### 4.è®¾ç½®è´¦å·å’Œå¯†ç 

> è®¾ç½®è´¦å·ä¸ºadminï¼Œå¯†ç ä¸ºapachepulsar

```
CSRF_TOKEN=$(curl http://localhost:7750/pulsar-manager/csrf-token)
curl \
   -H 'X-XSRF-TOKEN: $CSRF_TOKEN' \
   -H 'Cookie: XSRF-TOKEN=$CSRF_TOKEN;' \
   -H "Content-Type: application/json" \
   -X PUT http://localhost:7750/pulsar-manager/users/superuser \
   -d '{"name": "admin", "password": "apachepulsar", "description": "test", "email": "xxx@test.org"}'
```

![](https://img.javadog.net/blog/pulsar/8dac6a53f6a5419fa08c98e8baaeafd2.png)

##### 5.ç™»å½•æ§åˆ¶å°éªŒè¯

> è®¿é—® [http://localhost:9527/](http://localhost:9527/)

è¾“å…¥è´¦å·ï¼šadmin  å¯†ç ï¼šapachepulsar

![](https://img.javadog.net/blog/pulsar/9e8112bc96c847678cf0f5d160fb7095.png)

##### 6.æ–°å¢ç¯å¢ƒ

> æ–°å¢ç¯å¢ƒï¼Œå¡«å†™ç¯å¢ƒåï¼ŒåŠå¯åŠ¨çš„pulsarå•ä½“åº”ç”¨åœ°å€

![](https://img.javadog.net/blog/pulsar/2c78bedbde074387b78a6ce7471491b3.png)

##### 7.æŸ¥çœ‹æ§åˆ¶å°

![](https://img.javadog.net/blog/pulsar/67877c25e22f4b438b3443b4e7cd9dfb.png)

- Clusters (é›†ç¾¤)
å®šä¹‰: Pulsar é›†ç¾¤æ˜¯ä¸€ç»„è¿è¡Œ Pulsar Broker çš„æœåŠ¡å™¨é›†åˆã€‚
ä½œç”¨: å¤šä¸ªé›†ç¾¤å¯ä»¥è¢«é…ç½®æ¥**å®ç°åœ°ç†åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œä»¥æ”¯æŒæ•°æ®å¤åˆ¶å’Œç¾éš¾æ¢å¤**ã€‚
ç®¡ç†: ä½¿ç”¨ pulsar-admin clusters å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤ã€‚

- Tenants (ç§Ÿæˆ·)
å®šä¹‰: ç§Ÿæˆ·ä»£è¡¨äº†ç»„ç»‡æˆ–åº”ç”¨ç¨‹åºçš„é€»è¾‘åˆ†éš”ã€‚
ä½œç”¨: **ç§Ÿæˆ·ç”¨äºéš”ç¦»ä¸åŒç»„ç»‡çš„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºæ¯ä¸ªç§Ÿæˆ·è®¾ç½®è®¿é—®æ§åˆ¶ç­–ç•¥**ã€‚
ç®¡ç†: ä½¿ç”¨ pulsar-admin tenants å‘½ä»¤æ¥ç®¡ç†ç§Ÿæˆ·ã€‚

- Namespaces (å‘½åç©ºé—´)
å®šä¹‰: å‘½åç©ºé—´æ˜¯åœ¨ç§Ÿæˆ·å†…éƒ¨è¿›ä¸€æ­¥åˆ’åˆ†èµ„æºçš„æ–¹å¼ã€‚
ä½œç”¨: **å‘½åç©ºé—´ç”¨äºéš”ç¦»ä¸åŒåº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºæ¯ä¸ªå‘½åç©ºé—´è®¾ç½®ä¸åŒçš„ç­–ç•¥å’Œé…ç½®**ã€‚
ç®¡ç†: ä½¿ç”¨ pulsar-admin namespaces å‘½ä»¤æ¥ç®¡ç†å‘½åç©ºé—´ã€‚

- Topics (ä¸»é¢˜)
å®šä¹‰: ä¸»é¢˜æ˜¯æ¶ˆæ¯çš„å®é™…è½½ä½“ï¼Œæ˜¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯å’Œæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯çš„åœ°æ–¹ã€‚
ä½œç”¨: **æ¯ä¸ªä¸»é¢˜éƒ½å±äºä¸€ä¸ªç‰¹å®šçš„å‘½åç©ºé—´ï¼Œä¸»é¢˜å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…**ã€‚
ç®¡ç†: ä½¿ç”¨ pulsar-admin topics å‘½ä»¤æ¥ç®¡ç†ä¸»é¢˜ã€‚

- Tokens (ä»¤ç‰Œ)
å®šä¹‰: ä»¤ç‰Œæ˜¯ä¸€ç§è®¤è¯æœºåˆ¶ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡æä¾›ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œæ¥è®¿é—® Pulsar èµ„æºã€‚
ä½œç”¨: **ä»¤ç‰Œé€šå¸¸ç”¨äºç®€åŒ–å®¢æˆ·ç«¯è®¤è¯è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸éœ€è¦é•¿æœŸå‡­è¯çš„æƒ…å†µ**ã€‚
ç®¡ç†: ä½¿ç”¨ pulsar-admin tokens å‘½ä»¤æ¥ç®¡ç†ä»¤ç‰Œã€‚

******

#### å…­.å®é™…ç”µå•†ä¸šåŠ¡åˆ†æ

 ğŸŒ°åœºæ™¯å®ä¾‹

å¼ ä¸‰åœ¨ç”µå•†å¹³å°ä¹°äº†ä¸€ä¸ªäº§å“ï¼Œæ”¯ä»˜æˆåŠŸåï¼Œå¼ ä¸‰ç­‰ç€æ”¶è´§å°±å¥½...

ä½†æ˜¯åœ¨ç¨‹åºä¸šåŠ¡è§†è§’æ¥çœ‹ï¼Œæ”¯ä»˜æˆåŠŸåï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šä¸‹æ¸¸æœåŠ¡åœ¨é»˜é»˜æ‰§è¡Œã€‚

å¦‚åº“å­˜ã€ç‰©æµã€è®¢å•æœåŠ¡éƒ½ä¼šæœ‰ç›¸åº”é€»è¾‘æ‰§è¡Œã€‚

æˆ‘ä»¬å°±æ¨¡æ‹ŸçœŸå®ç”µå•†æ¡ˆä¾‹ï¼Œæ¥è®²è§£ä¸‹**å¦‚ä½•ä½¿ç”¨pulsarä»¥åŠpulsarèƒ½è§£å†³ä»€ä¹ˆç—›ç‚¹é—®é¢˜**ã€‚

![](https://img.javadog.net/blog/pulsar/9c8753995e2a454f9c7100b4f21fa061.png)

##### æƒ…å†µä¸€ï¼šæ²¡æœ‰ä½¿ç”¨pulsaræ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸šåŠ¡æ­£å¸¸ä¸²è¡Œæ‰§è¡Œ

å¼ ä¸‰æ”¯ä»˜æˆåŠŸåï¼Œæ›´æ–°è®¢å•ï¼Œæ›´æ–°åº“å­˜ï¼Œæ›´æ–°ç‰©æµ...ä¸²è¡Œæ“ä½œï¼Œæ¯ä¸ªæœåŠ¡éƒ½è€—æ—¶2ç§’

![](https://img.javadog.net/blog/pulsar/5f899377ea0e4a98bb8b7fdbd9945cf9.png)

è¿™ç§ä¸²è¡Œçš„æ‰§è¡Œæ–¹å¼æœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œå¦‚æœ**æ•´ä¸ªé“¾è·¯ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆå“åº”çš„æ—¶é—´å°±æ˜¯æ¯ä¸ªä¸šåŠ¡æ‰§è¡Œæ—¶é—´æƒ³åŠ ï¼Œæ›´æ–°è®¢å•(2ç§’)ï¼Œæ›´æ–°åº“å­˜(2ç§’)ï¼Œæ›´æ–°ç‰©æµ(2ç§’)ï¼Œæ€»å…±è€—æ—¶6ç§’**ã€‚

å¦‚æœè¿˜æœ‰å…¶ä»–ä¸‹æ¸¸ä¸šåŠ¡ï¼Œé“¾è·¯æ—¶é—´ä¼šä¸€ç›´å åŠ ï¼Œé€ æˆå¼ ä¸‰ç”¨æˆ·è®¿é—®ç­‰å¾…æ—¶é•¿ï¼Œå¹¶ä¸”å¦‚æœé“¾è·¯ä¸­æœ‰å¤±è´¥ï¼Œåˆ™ä¼šå¯¼è‡´æ•´ä¸ªé“¾è·¯å¼‚å¸¸

##### æƒ…å†µäºŒï¼šä½¿ç”¨pulsaræ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥è§£è€¦

å¼ ä¸‰æ”¯ä»˜æˆåŠŸåï¼Œæ›´æ–°è®¢å•ï¼Œæ›´æ–°åº“å­˜ï¼Œæ›´æ–°ç‰©æµ...å¹¶è¡Œæ“ä½œ

![](https://img.javadog.net/blog/pulsar/61322376e6184ce7b7d97dc258e87c44.png)

è¿™ç§ä½¿ç”¨å¼‚æ­¥è§£è€¦æ–¹å¼ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¼‚æ­¥æ‰§è¡Œï¼Œå“åº”ç«‹åˆ»è¿”å›ï¼Œç”¨æˆ·ä½“éªŒç»ä½³

******

#### ä¸ƒ.javaä¸­å¦‚ä½•ä½¿ç”¨pulsarè§£å†³ä¸šåŠ¡é—®é¢˜

æˆ‘ä»¬å°†ä¸Šé¢å…­ä¸­çš„ä¸¤ç§æƒ…å†µè¿›è¡Œä»£ç å®æ“ï¼Œ**ä¸²è¡Œæ‰§è¡Œå’Œä½¿ç”¨pulsarå¼‚æ­¥è§£è€¦**

##### 1.ä»£ç ç»“æ„

![](https://img.javadog.net/blog/pulsar/6f23b6ef0fbc4ce98ef15e869390dcb5.png)
##### 2.å…³é”®ä»£ç 

- å¼•å…¥pulsarä¾èµ–

![](https://img.javadog.net/blog/pulsar/c7b7450618d642b899d6f7074a43efe2.png)


```xml
  <dependency>
      <groupId>org.apache.pulsar</groupId>
      <artifactId>pulsar-client</artifactId>
      <version>${pulsar.version}</version>
  </dependency>
```

- pulsaré…ç½®

![](https://img.javadog.net/blog/pulsar/259bc1f7f595439f8549574d73f7508d.png)

```yml
pulsar:
  #æ”¯ä»˜topic
  pay-topic: persistent://public/default/pay-topic
  #æ”¯ä»˜subscription
  pay-subscription: pay-subscription
  #è®¢å•topic
  order-topic: persistent://public/default/order-topic
  #è®¢å•subscription
  order-subscription: order-subscription
  #åº“å­˜topic
  stock-topic: persistent://public/default/stock-topic
  #åº“å­˜subscription
  stock-subscription: stock-subscription
  #ç‰©æµtopic
  logistics-topic: persistent://public/default/logistics-topic
  #ç‰©æµsubscription
  logistics-subscription: logistics-subscription
```

![](https://img.javadog.net/blog/pulsar/da592faff38b466697469dfdc4588c1d.png)

```yml
# Pulsaré…ç½®
pulsar:
  url: pulsar://192.168.31.27:6650
```

- pulsarç”Ÿäº§è€…

![](https://img.javadog.net/blog/pulsar/63c7795fd8a94dfcaf88c96ba5aa3af2.png)

![](https://img.javadog.net/blog/pulsar/b33919433fbd4ddbb3e2e9bc24093de5.png)

![](https://img.javadog.net/blog/pulsar/5c32c65a9b5c4fdf91eaf44cf0703ad0.png)

```java
package net.javadog.pulsar.pay.service.pulsar.impl;

import cn.hutool.core.util.ObjectUtil;
import lombok.extern.slf4j.Slf4j;
import net.javadog.pulsar.logistics.service.pulsar.LogisticsPulsarProducer;
import net.javadog.pulsar.order.service.pulsar.OrderPulsarProducer;
import net.javadog.pulsar.stock.service.pulsar.StockPulsarProducer;
import org.apache.pulsar.client.api.*;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import javax.annotation.PostConstruct;
import javax.annotation.Resource;
import java.net.InetAddress;
import java.util.concurrent.TimeUnit;

/**
 * æ”¯ä»˜å¼‚æ­¥é€šçŸ¥-æ¶ˆè´¹è€…
 *
 * @author hdx
 * @version 1.0
 * @since 2024.07
 */
@Slf4j
@Component
public class PayPulsarConsumer {

    @Value("${pulsar.url}")
    private String url;
    @Value("${pulsar.pay-topic}")
    private String topic;
    @Value("${pulsar.pay-subscription}")
    private String subscription;

    private PulsarClient client = null;
    private Consumer<byte[]> consumer = null;

    private OrderPulsarProducer orderPulsarProducer;

    private StockPulsarProducer stockPulsarProducer;

    private LogisticsPulsarProducer logisticsPulsarProducer;


    @Resource
    public void setStockPulsarProducer(StockPulsarProducer stockPulsarProducer) {
        this.stockPulsarProducer = stockPulsarProducer;
    }

    @Resource
    public void setOrderPulsarProducer(OrderPulsarProducer orderPulsarProducer) {
        this.orderPulsarProducer = orderPulsarProducer;
    }

    @Resource
    public void setLogisticsPulsarProducer(LogisticsPulsarProducer logisticsPulsarProducer) {
        this.logisticsPulsarProducer = logisticsPulsarProducer;
    }

    /**
     * ä½¿ç”¨@PostConstructæ³¨è§£ç”¨äºåœ¨ä¾èµ–å…³ç³»æ³¨å…¥å®Œæˆä¹‹åéœ€è¦æ‰§è¡Œçš„æ–¹æ³•ä¸Šï¼Œä»¥æ‰§è¡Œä»»ä½•åˆå§‹åŒ–
     */
    @PostConstruct
    public void initPulsar() throws Exception {
        try {
            //æ„é€ Pulsar client
            client = PulsarClient.builder()
                    .serviceUrl(url)
                    .build();
            final String ip = InetAddress.getLocalHost().getHostAddress().replaceAll("\\.", "");
            //åˆ›å»ºconsumer
            consumer = client.newConsumer()
                    .topic(topic.split(","))
                    .consumerName("payPulsarConsumer" + ip)
                    .subscriptionName(subscription)
                    //æŒ‡å®šæ¶ˆè´¹æ¨¡å¼ï¼ŒåŒ…å«ï¼šExclusiveï¼ŒFailoverï¼ŒSharedï¼ŒKey_Sharedã€‚é»˜è®¤Exclusiveæ¨¡å¼
                    .subscriptionType(SubscriptionType.Shared)
                    //æŒ‡å®šä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹è¿˜æœ‰Latestï¼Œvalueofå¯é€‰ï¼Œé»˜è®¤Latest
                    .subscriptionInitialPosition(SubscriptionInitialPosition.Latest)
                    //æŒ‡å®šæ¶ˆè´¹å¤±è´¥åå»¶è¿Ÿå¤šä¹…brokeré‡æ–°å‘é€æ¶ˆæ¯ç»™consumerï¼Œé»˜è®¤60s
                    .negativeAckRedeliveryDelay(60, TimeUnit.SECONDS)
                    .batchReceivePolicy(BatchReceivePolicy.builder()
                    .maxNumBytes(10*1024*1024)
                    .maxNumMessages(-1)
                    .timeout(100, TimeUnit.MILLISECONDS)
                    .build())
                    .subscribe();
        } catch (Exception e) {
            log.error("Pulsaråˆå§‹åŒ–å¼‚å¸¸ï¼š", e);
            throw e;
        }
    }

    public void start() throws Exception {
        //æ¶ˆè´¹æ¶ˆæ¯
        log.debug("æ”¯ä»˜æ¶ˆè´¹è€…å¯åŠ¨");
        while (true) {
            Message<byte[]> message = consumer.receive();
            log.debug("æ¶ˆè´¹æ¶ˆæ¯ä¸­ï¼Œmessageï¼š{}", message);
            final String id = new String(message.getValue());

            if (ObjectUtil.isNotNull(id)) {
                try {
                    messageHandle(id);
                    consumer.acknowledge(message);
                } catch (Exception e) {
                    log.error("æ¶ˆè´¹Pulsaræ”¯ä»˜æ•°æ®å¼‚å¸¸ï¼Œkeyã€{}ã€‘ï¼ŒorderIdã€{}ã€‘ï¼š", message.getKey(), id, e);
                }
            }

        }
    }

    private void messageHandle(String orderId) {
        log.info("ã€æ”¯ä»˜æ¶ˆè´¹ã€‘ï¼ŒorderIdï¼š{}", orderId);

        // è®¢å•ç”Ÿäº§æ¶ˆæ¯
        orderPulsarProducer.handler(orderId, 0);

        // åº“å­˜ç”Ÿäº§æ¶ˆæ¯
        stockPulsarProducer.handler(orderId, 0);

        // ç‰©æµç”Ÿäº§æ¶ˆæ¯
        logisticsPulsarProducer.handler(orderId, 0);
    }

    public void close() {
        try {
            consumer.close();
        } catch (PulsarClientException e) {
            log.error("å…³é—­Pulsaræ¶ˆè´¹è€…å¤±è´¥ï¼š", e);
        }
        try {
            client.close();
        } catch (PulsarClientException e) {
            log.error("å…³é—­Pulsarè¿æ¥å¤±è´¥ï¼š", e);
        }
    }

}

```

##### 3.å¯åŠ¨è°ƒè¯•

-  ç¨‹åºå¯åŠ¨

> åœ¨pulsar-boot-mainä¸‹æ‰¾åˆ°Applicationå¹¶è¿è¡Œã€‚æ³¨æ„ï¼špulsarä¸€å®šå…ˆèµ·æ¥ï¼ï¼

![](https://img.javadog.net/blog/pulsar/fbb4bab03d624ebf98d3fb124bb569ec.png)

-  æ‰“å¼€swaggeræ¥å£æ–‡æ¡£

> åœ¨æ§åˆ¶å°æ‰“å¼€æ‰“å°çš„swaggeråœ°å€ï¼Œè¿›è¡Œæ¥å£è°ƒè¯•

![](https://img.javadog.net/blog/pulsar/8889863dba7441cf9109ee7627dbbc08.png)

-  è®¿é—®ä¸²è¡Œè°ƒç”¨æ–¹æ³•A

> éšæ„å½•å…¥orderIdï¼Œç‚¹å‡»**æ”¯ä»˜-æ™®é€šä¸²è¡Œæ”¯ä»˜-æ–¹å¼A**æ¥å£ã€Executeã€‘æŒ‰é’®ï¼ŒæŸ¥çœ‹ç»“æœ

![](https://img.javadog.net/blog/pulsar/a685529268bb4b23b44f140888806cb5.png)

![](https://img.javadog.net/blog/pulsar/5a802f606c454b068a6f9a02cc459d5f.png)

![](https://img.javadog.net/blog/pulsar/493ce85434b048c19af1aaf68bac114c.png)

-  è®¿é—®æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦æ–¹æ³•B

> éšæ„å½•å…¥orderIdï¼Œç‚¹å‡»**é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦-æ–¹å¼B**æ¥å£ã€Executeã€‘æŒ‰é’®ï¼ŒæŸ¥çœ‹ç»“æœ

![](https://img.javadog.net/blog/pulsar/6b8b0754d1d44543811d7b2607c083f4.png)

![](https://img.javadog.net/blog/pulsar/5b924f6481ed4fbe851086980d6c7c23.png)

![](https://img.javadog.net/blog/pulsar/ec076759c15d4d019e8e0b718ce20924.png)

##### 4.æ¼”ç¤ºæ€»ç»“

demoä»£ç é€»è¾‘ç®€å•ï¼Œä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼Œ**ä»¥æœ€ç›´è§‚çš„å“åº”æ—¶é—´æ¥å±•ç¤ºä½¿ç”¨pulsarå¼‚æ­¥è§£è€¦ä¼˜åŠ¿ï¼Œå¹¶ä½¿ç”¨ä¼˜é›…çš„åˆ†å±‚ä½¿ä»£ç ç»“æ„å¹²å‡€æ•´æ´**ã€‚

å¸Œæœ›å¤§å®¶èƒ½å¤Ÿ**ä¸‹è½½demoå®æ“ä¸€ä¸‹ï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´**ï¼›å½»åº•æŒæ¡ä½¿ç”¨pulsarçš„å°æŠ€å·§ï¼Œå°†å…¶è¿ç”¨åˆ°å®æˆ˜ä¸­ï¼ŒçœŸæ­£ä½“ç°å®ƒçš„ä¼˜ç‚¹ã€‚

### ğŸˆçŒœä½ æƒ³é—®

####  å¦‚ä½•ä¸ç‹—å“¥è”ç³»è¿›è¡Œæ¢è®¨

##### å…³æ³¨å…¬ä¼—å·ã€JavaDogç¨‹åºç‹—ã€‘

å…¬ä¼—å·å›å¤ã€å…¥ç¾¤ã€‘æˆ–è€…ã€åŠ å…¥ã€‘ï¼Œä¾¿å¯æˆä¸ºã€ç¨‹åºå‘˜å­¦ä¹ äº¤æµæ‘¸é±¼ç¾¤ã€‘çš„ä¸€å‘˜ï¼Œé—®é¢˜éšä¾¿é—®ï¼Œç‰›é€¼éšä¾¿å¹ï¼Œç›®å‰**ç¾¤å†…å·²æœ‰è¶…è¿‡300+ä¸ªå°ä¼™ä¼´å•¦**ï¼ï¼ï¼

![](https://img.javadog.net/blog/pulsar/e98d36c93ee2d2e1d59adb7005ca5486.png)

##### 2.è¸©è¸©ç‹—å“¥åšå®¢

[javadog.net](https://www.javadog.net/)

**é‡Œé¢æœ‰ç‹—å“¥çš„ç§å¯†è”ç³»æ–¹å¼å‘¦ ğŸ˜˜**

>å¤§å®¶å¯ä»¥åœ¨é‡Œé¢ç•™è¨€ï¼Œéšæ„å‘æŒ¥ï¼Œæœ‰é—®å¿…ç­”

![](https://img.javadog.net/blog/pulsar/e0650478576648aeb5ca12d5f32199ee.png)

###  ğŸ¯çŒœä½ å–œæ¬¢

####  æ–‡ç« æ¨è

[ã€å®æ“ã€‘Spring Cloud Alibaba AIï¼Œé˜¿é‡ŒAIè¿™ä¸å¾—ç©ä¸€ä¸‹(å«å‰åç«¯æºç )](https://mp.weixin.qq.com/s/ObTHS9Jplkp2ZjcUiBNFfg)

[ã€è§„èŒƒã€‘çœ‹çœ‹äººå®¶Gitæäº¤æè¿°ï¼Œé‚£å«ä¸€ä¸ªè§„çŸ©](https://mp.weixin.qq.com/s/EbNWRpSYMdWFv5aUQ2ockw)

[ã€é¡¹ç›®å®æˆ˜ã€‘SpringBoot+uniapp+uview2æ‰“é€ H5+å°ç¨‹åº+APPå…¥é—¨å­¦ä¹ çš„èŠå¤©å°é¡¹ç›®](https://mp.weixin.qq.com/s/g7AZOWLgW5vcCahyJDEPKA)

[ã€é¡¹ç›®å®æˆ˜ã€‘SpringBoot+uniapp+uview2æ‰“é€ ä¸€ä¸ªä¼ä¸šé»‘çº¢åå•åæ§½å°ç¨‹åº](https://mp.weixin.qq.com/s/t_qwF_HvkdW-6TI3sYUHrA)

[ã€æ¨¡å—åˆ†å±‚ã€‘è¿˜ä¸ä¼šSpringBooté¡¹ç›®æ¨¡å—åˆ†å±‚ï¼Ÿæ¥è¿™æ‰‹æŠŠæ‰‹æ•™ä½ ï¼](https://mp.weixin.qq.com/s/fpkiNR2tj832a6VxZozwDg)

![](https://img.javadog.net/blog/pulsar/a303cb88939e299ef9ff35fa1de5e25a.jpg)