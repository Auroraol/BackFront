# cloud-storage
文件云存储系统

## 介绍
Go 实战仿百度云盘，实现企业级分布云存储

# 第5章 “云存储”系统之基于Hash计算实现秒传

## Hash算法对比及秒传原理

### 文件校验值算法
* CRC(32/64)
* MD5
* SHA1

### 秒传原理
1. 在文件上传之初，将本地文件进行HASH计算，得出文件指纹；

2. 将文件指纹数据上传到服务器；

3. 服务端将文件指纹和现存的文件指纹进行比对，并返回比对结果给客户端；

4. 客户端获取比对结果；

5. 如果是比对成功，则说明服务端已经有同样的文件存在，则直接将文件名和指纹及文件标识符一并上传到服务端，而服务端在接受到之后，只是将文件名存放在客户的名下，文件则是映射到原有文件的路径中，返回秒传成功信息；

6. 如果比对不成功，就变得和普通上传并无二致，老老实实的通过HTTP的方式，将文件1比特，1比特的上传到服务端。


#### 场景
* 用户上传
* 离线下载
* 好友分享

#### 关键点
* 文件Hash(MD5,SHA1等)
* 用户文件关联

#### 服务架构
* 用户文件表
* 唯一文件表
* Hash计算
* 上传server
* 本地存储

# 第6章 基于Redis实现分块上传及断点续传  
## 分块上传与断点续传  
### 两个概念  
* 分块上传： 文件切成多块，独立传输，上传完成后合并
* 断点续传： 传输暂停或异常中断后，可基于原来进度重传
### 几点说明  
* 小文件不建议分块上传
* 可以并行上传分块，并且可以无序传输
* 分块上传能极大提高传输效率
* 减少传输失败后重试的流量及时间

### 分块上传流程
1. 初始化上传  
2. 上传分块（并行）
3. 通知上传完成

# “云存储”系统之基于Ceph实现私有云存储服务 【自主管理集群，技术可控】
## Ceph简介
Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性。

### Ceph特点
* 部署简单
* 可靠性高
* 性能高
* 分布式，可扩展性强
* 开源
* 客户端支持多语言


## Ceph集群介绍及兼容亚马逊S3接口详解
### Ceph基础组件
* OSD 用于集群中所有数据与对象的存储、复制、平衡、恢复数据等等
* Monitor 监控集群状态，维护Cluster MAP表，保证集群数据一致性


# 第10章 “云存储”系统之架构微服务化【全面优化系统架构及性能】

## 微服务基础概念与原理
### 微服务应用场景  
* 原有单体应用逻辑复杂，可以按业务逻辑进行划分  

### 微服务的优缺点

#### 优点
* 化繁为简，分散治理
* 服务间松耦合，服务内高内聚 
* 服务可独立构建/部署/升级，局部更新
* 提高系统的容错性，减少系统整体崩溃概率
* 易于实现异构系统

#### 缺点
* 增加了运维部署的工作量与难度
* 增加了系统间调用逻辑的处理难度
* 日志更难收集和统计
* 额外引入了一些非业务模块服务

## 云存储系统之微服务架构（1）
* api网关
* 上传调度
* 服务发现
* 上传服务集群
* 配置中心
* DBProxy
* 文件转移
> 文件转移主要是将用户上传的文件异步转移到第三方存储系统（如阿里云OSS等），本项目未进行实现

## gRPC与Protobuf基础原理

### rpc与restful接口调用
* 使用方面 是否关心调用方式、网络传输
* 性能效率方面 RPC相对高效，HTTP接口相对灵活
* 运维场景 Restful接口更适合终端与服务端之间的交互；rpc更适合微服务的应用间通讯

### 关于grpc框架
protobuf作为序列化协议  
HTTP2作为底层通讯协议
> HTTP2支持多路复用，即一条链接可发起多次请求， HTTP1是做不到的。

### 关于Protobuf
一种跨语言和跨平台的数据序列化协议  
与XML/JSON相比，序列化效率更快、体积更小、更安全  
与XML/JOSN相比，可读性差、灵活性较低  
自带编译器，定义proto源文件，可编译成多种语言的代码  


## go-micro

### go-micro提供的接口功能
* 服务发现： 支持服务注册与发现，底层支持etcd/consul/k8s
* 负载均衡： rpc服务间的请求调度均衡策略
* 同步通信：基于prc通信，支持单向、双向流通信模式
* 异步通信：提供pub/sub通信模型接口
* 高级接口： 比如服务发现，提供调用的接口是一致的

